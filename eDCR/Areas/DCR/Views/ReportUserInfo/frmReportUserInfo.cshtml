

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<link href="~/Content/CustomCSS/exportPDF.css" rel="stylesheet" />


<script src="~/Scripts/CustomJS/DefaultValue.js"></script>




<script type="text/javascript">


    $(document).ready(function () {
        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });

        EventPermission();
        LoadRegion();
        $('#IsActive').click(function () {
            if ($(this).is(':checked')) {
                $(this).siblings('label').html('Unhide');
                $('#divValueParameter').hide();
            }
            else {
                $(this).siblings('label').html('Hide');
                $('#divValueParameter').show();
            }
        });

        function LoadRegion() {
            $.ajax({
                url: '/Default/GetRegion',
                type: 'get',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#RegionCode').append($('<option>', { value: item.RegionCode, html: item.RegionName }, '<option/>'));
                        if (i == 0) {
                            if (data.length > 1) {
                                $('#RegionCode').append('<option value="" selected="selected"></option>');
                            }
                            LoadTM(item.RegionCode);
                        }
                        $('#RegionName').val(item.RegionName);
                    });
                },
                error: function () {
                    alert("Failed to load...");
                }
            });
        }
        $('#RegionCode').on('change', function () {
            LoadTM($(this).val());
            $('#RegionName').val($("#RegionCode option:selected").text());
        }).trigger('change');;

        function LoadTM(RegionCode) {
            $.ajax({
                url: '/Default/GetTerritoryFromRegion',
                data: { RegionCode: RegionCode },
                type: 'Post',
                dataType: 'json',
                success: function (data) {
                    $('#TerritoryManagerID').empty();
                    $.each(data, function (i, item) {

                        if (i == 0) {
                            if (data.length > 1) {
                                $('#TerritoryManagerID').append('<option value="" selected="selected"></option>');
                            }

                            $('#TerritoryManagerName').val(item.TerritoryManagerName);
                        }
                        $('#TerritoryManagerID').append($('<option>', { value: item.TerritoryManagerID, html: item.TerritoryManagerName }, '<option/>'));

                    });
                },
                error: function () {
                    alert("Failed to load...");
                }
            });
        }

     






        //Initializing Main page details Kendo Grid Colums
        var MainGrid = $('#MainGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "UserID",
                        fields: {
                            UserID: { type: "string", editable: false },
                            Password: { type: "string" },
                            EmpID: { type: "string" },
                            EmpName: { type: "string" },
                            Designation: { type: "string" },
                            PhoneNo: { type: "string" },
                            MPGroup: { type: "string" },
                            MarketCode: { type: "string" },
                            MarketName: { type: "string" },
                            SBU: { type: "string" },

                            RegionCode: { type: "string" },
                            RegionName: { type: "string" },
                            DepotCode: { type: "string" },
                            DepotName: { type: "string" },
                            DivisionCode: { type: "string" },
                            DivisionName: { type: "string" },
                        }
                    }
                },
               // pageSize: 10,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);
            },
            scrollable: true,
            sortable: true,
            filterable: false,
            editable: true,
            selectable: "row",
            //selectable: "multiple",
            toolbar: ["excel", { template: "<input type='text' id='txtSBU'  style='float:right' placeholder='SBU' class='k-textbox'>" }, { template: "<input type='text' id='txtMarket'  style='float:right' placeholder='Market' class='k-textbox'>" }, { template: "<input type='text' id='txtDesignation'  style='float:right' placeholder='Designation' class='k-textbox'>" }, { template: "<input type='text' id='txtUserEmp'  style='float:right' placeholder='User/Emp ID' class='k-textbox'>" }, ],
            excel: {
                fileName: "User.xlsx",
                allPages: true,
                filterable: true
            },
            navigatable: true,
            columnMenu: false,
            reorderable: false,
            resizable: false,
            resize: function (e) {
                this.table.height(this.element.height() + this.table.height() - 1);
            },
            columns: [
                 { field: "UserID", title: "User ID", hidden: false },
                 { field: "Password", title: "Password" },
                 { field: "EmpID", title: "Employee ID", hidden: false },
                 { field: "EmpName", title: "Employee Name" },
                 { field: "Designation", title: "Designation" },
                 { field: "PhoneNo", title: "Phone No" },
                 { field: "MPGroup", title: "MPGroup", hidden: false },
                 { field: "MarketCode", title: "LocCode",hidden: true },
                 { field: "MarketName", title: "Loction Name" },
                 { field: "SBU", title: "SBU"},
                { field: "RegionCode", title: "Region Code" },
                { field: "RegionName", title: "Region Name" },
                { field: "DepotCode", title: "Depot Code" },
                { field: "DepotName", title: "Depot Name" }, 
                { field: "DivisionCode", title: "Division Code" },
                { field: "DivisionName", title: "Division Name"},

            ],


        }).data('kendoGrid');




        $("#txtUserEmp").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                     { field: "UserID", operator: "contains", value: val },
                     { field: "EmpID", operator: "contains", value: val },
                ]
            });
        });

        $("#txtDesignation").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [

                     { field: "Designation", operator: "contains", value: val },
                ]
            });
        });
        $("#txtMarket").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [

                     { field: "MarketName", operator: "contains", value: val },
                ]
            });
        });


        $("#txtSBU").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "SBU", operator: "contains", value: val },
                   
                ]
            });
        });
        AutoFitColumn("MainGrid");
        var gridInput = 0;
        function GridValidation() {
            gridInput = 0;
            var dataSource = $("#MainGrid").data("kendoGrid").dataSource;
            data = dataSource.data(); // Get Detail Grid Data
            if (dataSource.view().length > 0) {
                gridInput = 0;
            }
            else {
                gridInput = 1;
            }
        }


        $('#btnView').click(function () {

            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

            var model = {};


            model.RegionCode = $("#RegionCode").val();
            model.TerritoryManagerID = $("#TerritoryManagerID").val();

            var Input = InputValidation('RegionCode');

            if ($("#RoleID").val() == "17" || $("#RoleID").val() == "01")
            {
            
                Input = 0;
            }
            if (Input == 0) {
                $("#divLoading").show();
                $.ajax({
                    type: "POST",
                    url: '/ReportUserInfo/GetUserInfo',
                    data: JSON.stringify({ model: model }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.length > 0) {
                            $("#MainGrid").data("kendoGrid").dataSource.data(data);
                        }
                        $("#divLoading").hide();
                    },
                });
            }
            else {
                ValidationMsg();
                toastr.info($("#MessageText").html());
            }
        });

    });




</script>


<div class="box-header with-border">
    @*Form Title*@
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2"><div id="MessageText"></div></div>
        <div class="col-xs-0 col-sm-0 col-md-10 col-lg-10">
            <div style="text-align:right;">
              <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-file"></i> View</button>
            </div>
        </div>
    </div>
</div>

<div class="box-body">
    <div class="row" id="divValueParameter">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2"></div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">         
                <input type="hidden" id="RoleID" name="RoleID" value=@Session["RoleID"] class="RequiredField form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Region Name :</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <select id="RegionCode" name="RegionCode" class="RequiredField form-control"></select>
                <input type="hidden" id="RegionName" name="RegionName" class="RequiredField form-control">
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">TM Name :</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <select id="TerritoryManagerID" name="TerritoryManagerID" class="RequiredField form-control"></select>
                <input type="hidden" id="TerritoryManagerName" name="TerritoryManagerName" class="RequiredField form-control">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div id="MainGrid" class="MainGrid"></div>

        </div>
    </div>
</div>
<div class="box-footer">@*Form Footer*@</div>
<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p style="position: absolute; top: 50%; left: 50%; color: White;">
        <img src="~/Content/Images/loading.gif" />
    </p>
</div>