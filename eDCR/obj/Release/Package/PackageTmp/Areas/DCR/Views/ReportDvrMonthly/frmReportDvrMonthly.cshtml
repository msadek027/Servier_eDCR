@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="box-header with-border">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <form class="form" action="/ReportDvrMonthly/Export" id="R1Form" method="post" name="H1Form" target="_blank">

                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2"><div id="MessageText"></div></div>
                    <div class="col-xs-0 col-sm-0 col-md-10 col-lg-10">
                        <div style="text-align:right;">
                            <input type="checkbox" id="IsActive" class="chk" name="IsActive"> <label for="IsActive"> Hide</label>
                            <button type="submit" id="btnExcel" name="ExportType" value="Excel" class="btn btn-primary btn-sm" onclick="return InputValidationPdfExcel();" formaction="/ReportDvrMonthly/Export" data-toggle="tooltip" data-placement="right" title="[Mandatory: Month, Year, Region,TM]"><i class="glyphicon glyphicon-envelope"></i> Excel </button>
                            <button type="submit" id="btnPDF" name="ExportType" value="PDF" class="btn btn-primary btn-sm" onclick="return InputValidationPdfExcel();" formaction="/ReportDvrMonthly/Export" data-toggle="tooltip" data-placement="right" title="[Mandatory: Month, Year, Region,TM]"><i class="glyphicon glyphicon-book"></i> Pdf </button>
                            <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-file"></i> View</button>
                            <a id="btnZoomingView" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-zoom-in"></i> Zoom</a>
                        </div>
                    </div>
                </div>

                        <div class="box-body">
                            <div class="row" id="divValueParameter">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3"> Month - Year:</div>
                                    <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">
                                        <div class="input-group">
                                            <select id="MonthNumber" name="MonthNumber" class=" RequiredField form-control"></select>
                                            <span class="input-group-btn" style="width:0px;"></span>
                                            <input type="text" id="Year" name="Year" class="datepicker RequiredField form-control" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">Region Name :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
                                        <select id="RegionCode" name="RegionCode" class="RequiredField form-control"></select>
                                        <input type="hidden" id="RegionName" name="RegionName" class="RequiredField form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">TM Name :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
                                        <select id="TerritoryManagerID" name="TerritoryManagerID" class="RequiredField form-control"></select>
                                        <input type="hidden" id="TerritoryManagerName" name="TerritoryManagerName" class="RequiredField form-control">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">MPO Name :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
                                        <select id="MPGroup" name="MPGroup" class="RequiredField form-control"></select>
                                        <input type="hidden" id="MPOName" name="MPOName" class="RequiredField form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
            </form>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div id="MainGrid" class="MainGrid"></div>
    </div>
</div>




<div class="row">

    <div id="DetailPopupWindow" class="PopupWindowLayout" style="display: none;">
        <div class="input-group">
            <div id="Parameter"></div><span class="input-group-btn" style="width:20px;"></span><div style="background-color:lightskyblue" id="Parameter2"></div>
        </div>
        <div class="input-group">
            <div id="WpDcrGrid" class="PopUpGrid"></div>
        </div>
        

    </div>

</div>
<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p style="position: absolute; top: 50%; left: 50%; color: White;">
        <img src="~/Content/Images/loading.gif" />
    </p>
</div>










<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<link href="~/Content/CustomCSS/exportPDF.css" rel="stylesheet" />
<script src="~/Scripts/CustomJS/DefaultValue.js"></script>


<style>
    .k-grid .k-grid-content {
        min-height: 10px;
        max-height: 350px;
    }

    .k-grid-header .k-header {
        height: 15px;
        padding: 0;
    }

    .k-grid-header-wrap th {
        font-size: 14px;
        /*font-size: small !important;*/
    }

    .k-grid tbody tr {
        line-height: 10px;
        font-size: 13px;
    }

    .k-grid tbody td {
        padding: 3px;
    }
</style>

<script type="text/javascript">
    //// Start  $(document).ready(function ()
    $(document).ready(function () {

        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });

        EventPermission();
        //$("#GrandTotal").kendoNumericTextBox({
        //    format: "n0",
        //    decimals: 0
        //});
        $('#btnReset').click(function () {
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);
            ResetData();
            $("#Year").val(yyyy);

        });
        $(".datepicker").datepicker({
            format: " yyyy",
            viewMode: "years",
            minViewMode: "years",
            autoclose: true
        });
        $("#Year").val(yyyy);
        LoadMonth();


        function LoadMonth() {
            $.ajax({
                url: '/Default/GetGenMonth',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#MonthNumber').append($('<option>', { value: item.MonthNumber, html: item.MonthName }, '<option/>'));
                    });
                },
                error: function () {
                    alert("Failed to load !!");
                }
            });
        }

        LoadRegion();


        function LoadRegion() {
            $.ajax({
                url: '/Default/GetRegion',
                type: 'get',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#RegionCode').append($('<option>', { value: item.RegionCode, html: item.RegionName }, '<option/>'));
                        if (i == 0) {
                            LoadTM(item.RegionCode);
                        }
                        $('#RegionName').val(item.RegionName);
                    });
                },
                error: function () {
                    alert("Failed to load...");
                }
            });
        }
        $('#RegionCode').on('change', function () {
            LoadTM($(this).val());
            $('#RegionName').val($("#RegionCode option:selected").text());
        }).trigger('change');;

        function LoadTM(RegionCode) {
            $.ajax({
                url: '/Default/GetTerritoryFromRegion',
                data: { RegionCode: RegionCode },
                type: 'Post',
                dataType: 'json',
                success: function (data) {
                    $('#TerritoryManagerID').empty();
                    $.each(data, function (i, item) {

                        if (i == 0) {
                            if (data.length > 1) {
                                $('#TerritoryManagerID').append('<option value="" selected="selected"></option>');
                            }
                            LoadMPO(item.TerritoryManagerID);
                            $('#TerritoryManagerName').val(item.TerritoryManagerName);
                        }
                        $('#TerritoryManagerID').append($('<option>', { value: item.TerritoryManagerID, html: item.TerritoryManagerName }, '<option/>'));

                    });
                },
                error: function () {
                    alert("Failed to load...");
                }
            });
        }



        $('#TerritoryManagerID').on('change', function () {
            LoadMPO($(this).val());
            $('#TerritoryManagerName').val($("#TerritoryManagerID option:selected").text());
        }).trigger('change');;




        function LoadMPO(TerritoryManagerID) {

            $.ajax({
                url: '/Default/GetMPOPopupList',
                data: { TerritoryManagerID: TerritoryManagerID },
                type: 'Post',
                dataType: 'json',
                success: function (data) {
                    $('#MPGroup').empty();
                    $.each(data, function (i, item) {
                        if (i == 0) {
                            $('#MPGroup').append('<option value="" selected="selected"></option>');
                            $('#MPOName').val(item.MPOName);
                        }
                        $('#MPGroup').append($('<option>', { value: item.MPGroup, html: item.MPOName }, '<option/>'));

                    });
                },

                error: function () {
                    alert("Failed to load...");
                }
            });

        }
        LoadTM($("#RegionCode").val());
        LoadMPO($("#TerritoryManagerID").val());

        $('#MPGroup').on('change', function () {
            $('#MPOName').val($("#MPGroup option:selected").text());
        }).trigger('change');;

        $("#TerritoryManagerID,#MPGroup").on('change', function (e) {
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

        });


        var MainGrid = $("#MainGrid").kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: false,
                schema: {
                    model: {
                        id: "DoctorID",
                        fields: {
                            DoctorID: { type: "string" },
                        }
                    }
                },
                pageSize: 100,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 10
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);
                //var GrandTotal = 0;
                //var PIGridDataSource = $("#MainGrid").data("kendoGrid").dataSource;
                //var PIGridData = PIGridDataSource.data();
                //for (i = PIGridData.length - 1; i >= 0; i--) {
                //    var me = parseFloat(PIGridData[i].MED);
                //    GrandTotal = GrandTotal + me;
                //}
                //var GrandTotalValue = $("#GrandTotal").data("kendoNumericTextBox");
                //GrandTotalValue.value(GrandTotal);
            },
    
           
            selectable: "row",
            //selectable: "multiple",
            toolbar: [{ template: "<input type='text' id='txtInput'  style='float:right' placeholder='Search...' class='k-textbox'>" }, ],
          

            height: 450,
            scrollable: true,
            sortable: true,
            filterable: false,
            editable: false,
            navigatable: false,
            columnMenu: false,
            reorderable: false,
            //resizable: true,
            //resize: function (e) {
            //    this.table.height(this.element.height() + this.table.height() - 1);
            //},
            columns: [
                { field: "SL", title: "SL", locked: true},
                 { field: "DoctorID", title: "DoctorID", hidden: true },
                 { field: "DoctorName", title: "Doctor Name", locked: true },
                 { field: "Potential", title: "Ca." },
                 { field: "ShiftName", title: "Shift" },
                 { field: "MPOCode", title: "MPO", hidden: false },           
                 { field: "MPGroup", title: "Group", hidden: true },
                { field: "MED", title: "MED" },
                { field: "MEP", title: "MEP" },
                { field: "MEE", title: "MEE" },
                { field: "MEA", title: "MEA" },
                 {
                     title: "MORNING", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" },
                     columns: [
                          { field: "MD", title: "MD", width: 40 },
                          { field: "md01", title: "01", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd01'> ${md01} </a>" },
                          { field: "md02", title: "02", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd02'> ${md02} </a>" },
                          { field: "md03", title: "03", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd03'> ${md03} </a>" },
                          { field: "md04", title: "04", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd04'> ${md04} </a>" },
                          { field: "md05", title: "05", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd05'> ${md05} </a>" },
                          { field: "md06", title: "06", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd06'> ${md06} </a>" },
                          { field: "md07", title: "07", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd07'> ${md07} </a>" },
                          { field: "md08", title: "08", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd08'> ${md08} </a>" },
                          { field: "md09", title: "09", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd09'> ${md09} </a>" },
                          { field: "md10", title: "10", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd10'> ${md10} </a>" },
                          { field: "md11", title: "11", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd11'> ${md11} </a>" },
                          { field: "md12", title: "12", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd12'> ${md12} </a>" },
                          { field: "md13", title: "13", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd13'> ${md13} </a>" },
                          { field: "md14", title: "14", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd14'> ${md14} </a>" },
                          { field: "md15", title: "15", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd15'> ${md15} </a>" },
                          { field: "md16", title: "16", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd16'> ${md16} </a>" },
                          { field: "md17", title: "17", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd17'> ${md17} </a>" },
                          { field: "md18", title: "18", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd18'> ${md18} </a>" },
                          { field: "md19", title: "19", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd19'> ${md19} </a>" },
                          { field: "md20", title: "20", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd20'> ${md20} </a>" },
                          { field: "md21", title: "21", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd21'> ${md21} </a>" },
                          { field: "md22", title: "22", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd22'> ${md22} </a>" },
                          { field: "md23", title: "23", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd23'> ${md23} </a>" },
                          { field: "md24", title: "24", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd24'> ${md24} </a>" },
                          { field: "md25", title: "25", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd25'> ${md25} </a>" },
                          { field: "md26", title: "26", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd26'> ${md26} </a>" },
                          { field: "md27", title: "27", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd27'> ${md27} </a>" },
                          { field: "md28", title: "28", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd28'> ${md28} </a>" },
                          { field: "md29", title: "29", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd29'> ${md29} </a>" },
                          { field: "md30", title: "30", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd30'> ${md30} </a>" },
                          { field: "md31", title: "31", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinkmd31'> ${md31} </a>" },
                     ]
                 },
               {
                   title: "EVENING", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" },
                   columns: [
                         { field: "ED", title: "ED", width: 40 },
                          { field: "ed01", title: "01", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked01'> ${ed01} </a>" },
                          { field: "ed02", title: "02", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked02'> ${ed02} </a>" },
                          { field: "ed03", title: "03", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked03'> ${ed03} </a>" },
                          { field: "ed04", title: "04", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked04'> ${ed04} </a>" },
                          { field: "ed05", title: "05", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked05'> ${ed05} </a>" },
                          { field: "ed06", title: "06", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked06'> ${ed06} </a>" },
                          { field: "ed07", title: "07", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked07'> ${ed07} </a>" },
                          { field: "ed08", title: "08", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked08'> ${ed08} </a>" },
                          { field: "ed09", title: "09", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked09'> ${ed09} </a>" },
                          { field: "ed10", title: "10", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked10'> ${ed10} </a>" },
                          { field: "ed11", title: "11", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked11'> ${ed11} </a>" },
                          { field: "ed12", title: "12", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked12'> ${ed12} </a>" },
                          { field: "ed13", title: "13", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked13'> ${ed13} </a>" },
                          { field: "ed14", title: "14", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked14'> ${ed14} </a>" },
                          { field: "ed15", title: "15", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked15'> ${ed15} </a>" },
                          { field: "ed16", title: "16", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked16'> ${ed16} </a>" },
                          { field: "ed17", title: "17", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked17'> ${ed17} </a>" },
                          { field: "ed18", title: "18", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked18'> ${ed18} </a>" },
                          { field: "ed19", title: "19", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked19'> ${ed19} </a>" },
                          { field: "ed20", title: "20", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked20'> ${ed20} </a>" },
                          { field: "ed21", title: "21", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked21'> ${ed21} </a>" },
                          { field: "ed22", title: "22", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked22'> ${ed22} </a>" },
                          { field: "ed23", title: "23", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked23'> ${ed23} </a>" },
                          { field: "ed24", title: "24", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked24'> ${ed24} </a>" },
                          { field: "ed25", title: "25", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked25'> ${ed25} </a>" },
                          { field: "ed26", title: "26", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked26'> ${ed26} </a>" },
                          { field: "ed27", title: "27", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked27'> ${ed27} </a>" },
                          { field: "ed28", title: "28", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked28'> ${ed28} </a>" },
                          { field: "ed29", title: "29", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked29'> ${ed29} </a>" },
                          { field: "ed30", title: "30", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked30'> ${ed30} </a>" },
                          { field: "ed31", title: "31", width: 40, template: "<a href='javascript:void(0)' style='text-decoration: underline;'  class='a:link btnLinked31'> ${ed31} </a>" },

                   ]
               },

            ],
        });

        $("#txtInput").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "DoctorID", operator: "contains", value: val },
                    { field: "DoctorName", operator: "contains", value: val },
           
                ]
            });
        });


        $('#IsActive').click(function () {
            if ($(this).is(':checked')) {
                $(this).siblings('label').html('Unhide');
                $('#divValueParameter').hide();
            }
            else {
                $(this).siblings('label').html('Hide');
                $('#divValueParameter').show();
            }
        });

        $('#btnView').click(function () {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

            var model = {};

            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.TerritoryManagerID = $("#TerritoryManagerID").val();
            model.MarketCode = $("#MarketCode").val();
            model.MPGroup = $("#MPGroup").val();



            var Input = InputValidation('MonthNumber') + InputValidation('Year');
            if (Input == 0) {
                MainGridView(model);
            }

            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }


        });

        function MainGridView(model) {
            $.ajax({
                type: "POST",
                url: "/ReportDvrMonthly/GetMainGridData",
                data: JSON.stringify({ model: model }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data.length > 0) {
                        $("#MainGrid").data("kendoGrid").dataSource.data(data);
                    }
                    else {
                        AcknowledgeMsg();
                        toastr.info($("#MessageText").html());

                    }
                },

            });

        }

        var ReportHeader = "";
        $('#btnZoomingView').click(function () {

            if ($("#Year").val() != "" && $("#MonthNumber").val() != "") {
                ReportHeader = "Year-Month: " + $("#Year").val() + "-" + $("#MonthNumber").val()
            }
            if ($("#TerritoryManagerID").val() != "") {
                ReportHeader = ReportHeader + ", TM: " + $("#TerritoryManagerName").val();
            }
            if ($("#MarketCode").val() != "") {
                ReportHeader = ReportHeader + ", Market: " + $("#MarketName").val();
            }
            if ($("#MPGroup").val() != "") {

                ReportHeader = ReportHeader + ", MPO: " + $("#MPOName").val();

            }
            sessionStorage.setItem('keyYear', $("#Year").val());
            sessionStorage.setItem('keyMonthNumber', $("#MonthNumber").val());
            sessionStorage.setItem('keyTerritoryManagerID', $("#TerritoryManagerID").val());
            sessionStorage.setItem('keyMarketCode', $("#MarketCode").val());
            sessionStorage.setItem('keyMPGroup', $("#MPGroup").val());
            sessionStorage.setItem('keyReportHeader', ReportHeader);

            var Year = $("#Year").val();
            var MonthNumber = $("#MonthNumber").val();
            var TerritoryManagerID = $("#TerritoryManagerID").val();
            var MarketCode = $("#MarketCode").val();
            var MPGroup = $("#MPGroup").val();
            var Input = InputValidation('MonthNumber') + InputValidation('Year');
            if (Input == 0) {
                window.open("/DCR/ReportDvrMonthly/frmReportDvrMonthly2?Year=" + Year + "&MonthNumber=" + MonthNumber + "&TerritoryManagerID=" + TerritoryManagerID + "&MarketCode=" + $("#MarketCode").val() + "&MPGroup=" + $("#MPGroup").val() + "");

            }

            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }
        });














        $("#MainGrid").on("click", ".btnLinkmd01", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "01", "m");
        });

        $("#MainGrid").on("click", ".btnLinkmd02", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "02", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd03", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "03", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd04", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "04", "m");
        });

        $("#MainGrid").on("click", ".btnLinkmd05", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "05", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd06", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "06", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd07", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "07", "m");
        });

        $("#MainGrid").on("click", ".btnLinkmd08", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "08", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd09", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "09", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd10", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "10", "m");
        });

        $("#MainGrid").on("click", ".btnLinkmd11", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "11", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd12", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "12", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd13", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "13", "m");
        });

        $("#MainGrid").on("click", ".btnLinkmd14", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "14", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd15", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "15", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd16", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "16", "m");
        });

        $("#MainGrid").on("click", ".btnLinkmd17", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "17", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd18", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "18", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd19", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "19", "m");
        });

        $("#MainGrid").on("click", ".btnLinkmd20", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "20", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd21", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "21", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd22", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "22", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd23", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "23", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd24", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "24", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd25", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "25", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd26", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "26", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd27", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "27", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd28", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "28", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd29", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "29", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd30", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "30", "m");
        });
        $("#MainGrid").on("click", ".btnLinkmd31", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "31", "m");
        });





        $("#MainGrid").on("click", ".btnLinked01", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "01", "e");
        });

        $("#MainGrid").on("click", ".btnLinked02", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "02", "e");
        });
        $("#MainGrid").on("click", ".btnLinked03", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "03", "e");
        });
        $("#MainGrid").on("click", ".btnLinked04", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "04", "e");
        });

        $("#MainGrid").on("click", ".btnLinked05", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "05", "e");
        });
        $("#MainGrid").on("click", ".btnLinked06", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "06", "e");
        });
        $("#MainGrid").on("click", ".btnLinked07", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "07", "e");
        });

        $("#MainGrid").on("click", ".btnLinked08", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "08", "e");
        });
        $("#MainGrid").on("click", ".btnLinked09", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "09", "e");
        });
        $("#MainGrid").on("click", ".btnLinked10", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "10", "e");
        });

        $("#MainGrid").on("click", ".btnLinked11", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "11", "e");
        });
        $("#MainGrid").on("click", ".btnLinked12", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "12", "e");
        });
        $("#MainGrid").on("click", ".btnLinked13", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "13", "e");
        });

        $("#MainGrid").on("click", ".btnLinked14", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "14", "e");
        });
        $("#MainGrid").on("click", ".btnLinked15", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "15", "e");
        });
        $("#MainGrid").on("click", ".btnLinked16", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "16", "e");
        });

        $("#MainGrid").on("click", ".btnLinked17", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "17", "e");
        });
        $("#MainGrid").on("click", ".btnLinked18", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "18", "e");
        });
        $("#MainGrid").on("click", ".btnLinked19", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "19", "e");
        });

        $("#MainGrid").on("click", ".btnLinked20", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "20", "e");
        });
        $("#MainGrid").on("click", ".btnLinked21", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "21", "e");
        });
        $("#MainGrid").on("click", ".btnLinked22", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "22", "e");
        });
        $("#MainGrid").on("click", ".btnLinked23", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "23", "e");
        });
        $("#MainGrid").on("click", ".btnLinked24", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "24", "e");
        });
        $("#MainGrid").on("click", ".btnLinked25", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "25", "e");
        });
        $("#MainGrid").on("click", ".btnLinked26", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "26", "e");
        });
        $("#MainGrid").on("click", ".btnLinked27", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "27", "e");
        });
        $("#MainGrid").on("click", ".btnLinked28", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "28", "e");
        });
        $("#MainGrid").on("click", ".btnLinked29", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "29", "e");
        });
        $("#MainGrid").on("click", ".btnLinked30", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "30", "e");
        });
        $("#MainGrid").on("click", ".btnLinked31", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));
            GetDetailData(dataItem, "31", "e");
        });


        function GetDetailData(dataItem, DayNumber, ShiftName) {
            $('#WpDcrGrid').data('kendoGrid').dataSource.filter([]);
            $('#WpDcrGrid').data('kendoGrid').dataSource.data([]);
          


            var DoctorID = dataItem.DoctorID;
            var DoctorName = dataItem.DoctorName;
            var MPGroup = dataItem.MPGroup;

            var model = {};
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.TerritoryManagerID = $("#TerritoryManagerID").val();

            model.MPGroup = dataItem.MPGroup;
            model.DoctorID = dataItem.DoctorID;



            model.DayNumber = DayNumber;
            model.ShiftName = ShiftName;

            var MonthNumber = $("#MonthNumber").val();
            var Year = $("#Year").val();
            var Parameter = "" + DoctorName + " (" + DoctorID + "), " + DayNumber + "-" + MonthNumber + "-" + Year + ", " + ShiftName + " [" + MPGroup + "]. ";
            $("#Parameter").html(Parameter);

            DetailPopupWindow.center();
            DetailPopupWindow.open();


            $.ajax({
                type: "POST",
                url: "/ReportDvrMonthly/GetDvrWpDcr",
                data: JSON.stringify({ model: model }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data.Status == "Yes") {                 
                        $("#Parameter2").html(data.DvrStatus);
                        $('#WpDcrGrid').data('kendoGrid').dataSource.data(data.data);                       
                        if (data.DvrWpDcrStatus == "NO" )
                        { 
                         DetailPopupWindow.close();
                        }
                        
                    }
                    else {
                        DetailPopupWindow.close();
                    }



                },
                error: function () {
                    alert('Error occured!');
                },
            });
            
        }
        var DetailPopupWindow = $("#DetailPopupWindow").kendoWindow({
            width: "50%",
            draggable: true,
            modal: true,
            resizable: true,
            title: "List",
        }).data("kendoWindow");



        var WpDcrGrid = $('#WpDcrGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "MPGroup",
                        fields: {
                            MPGroup: { type: "string" },
                        }
                    }
                },
                pageSize: 10,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);
            },

            scrollable: true,
            sortable: true,
            width: 300,
            filterable: false,
            editable: false,
            selectable: "row",
            navigatable: true,
            groupable: { messages: { empty: "WP & DCR List" } },
            columnMenu: false,
            reorderable: false,
            resizable: false,
            resize: function (e) {
                this.table.height(this.element.height() + this.table.height() - 1);
            },
            columns: [
                { field: "MPGroup", title: "MPGroup", hidden: true },
                 { field: "SetDate", title: "SetDate", hidden: true },
                 { field: "ProductCode", title: "Product Code" },
                 { field: "ProductName", title: "Product Name" },
                { field: "Quantity", title: "Qty" },
                { field: "Type", title: "Type" }
            ]

        }).data('kendoGrid');
    });
</script>
<script language="javascript" type="text/javascript">

    function InputValidationPdfExcel() {
        var Input = InputValidation('MonthNumber') + InputValidation('Year');
        if (Input == 0) {
            return true;
        }
        else
            return false;
    }

</script>






