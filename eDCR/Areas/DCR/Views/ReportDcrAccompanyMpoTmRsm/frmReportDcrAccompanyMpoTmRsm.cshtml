@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}




<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<link href="~/Content/CustomCSS/exportPDF.css" rel="stylesheet" />
<script src="~/Scripts/CustomJS/DefaultValue.js"></script>
<script>
    $(document).ready(function () {
        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });
        EventPermission();

        $('#Designation').on('change', function () {
            GetEmpForSup($(this).val());
        }).trigger('change');

        $('#LocCode').select2();
        function GetEmpForSup(Designation) {
            $.ajax({
                type: "POST",
                url: '/Default/GetEmpCodeForOwnSupfrmDesignation',
                data: JSON.stringify({ Designation: Designation }),
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $('#LocCode').empty();
                    $.each(data, function (i, item) {

                        if (i == 0) {
                            if (data.length > 1) {
                                $('#LocCode').append('<option value="" selected="selected"></option>');
                            }
                        }
                        $('#LocCode').append($('<option>', { value: item.LocCode, html: item.EmployeeName }, '<option/>'));
                        $('#LocName').val(item.EmployeeName);

                    });

                },
                error: function () {
                    alert("Failed to load ... !!");
                }
            });
        }


        $('#LocCode').on('change', function () {
            $('#LocName').val($("#LocCode option:selected").text());
        }).trigger('change');



        //**************reset function*************************
        $('#btnReset').click(function () {
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

            ResetData();

        });

        $('#IsActive').click(function () {
            if ($(this).is(':checked')) {
                $(this).siblings('label').html('Unhide');
                $('#divValueParameter').hide();
            }
            else {
                $(this).siblings('label').html('Hide');
                $('#divValueParameter').show();
            }
        });

        //***************view function*****************
        $('#btnView').click(function () {

            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

            var model = {};

            model.FromDate = $("#FromDate").val();
            model.ToDate = $("#ToDate").val();
            model.LocCode = $("#LocCode").val();
            model.LocName = $("#LocCode option:selected").text();;
            model.Designation = $("#Designation").val();

            var fromDateParts = model.FromDate.split("-");
            var fromDateObject = new Date(fromDateParts[2], fromDateParts[1] - 1, fromDateParts[0]);

            var toDateParts = model.ToDate.split("-");
            var toDateObject = new Date(toDateParts[2], toDateParts[1] - 1, toDateParts[0]);

            if (fromDateObject > toDateObject) {
                $('#FromDate').css("border", "1px solid red");
                $('#ToDate').css("border", "1px solid red");
                $('#ToDate').val("");
                toastr.warning("To Date cannot be greater than From Date");
                return false;
            }

            var Input = InputValidation('FromDate') + InputValidation('ToDate') + InputValidation('Designation') + InputValidation('LocCode');
            if (Input == 0) {

                   $.ajax({
                       type: "POST",
                       url: "/ReportDcrAccompanyMpoTmRsm/GetDataMainView",
                        data: JSON.stringify({ model : model }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                       if (data.length > 0) {

                            $("#MainGrid").data("kendoGrid").dataSource.data(data);
                            $('tfoot:visible').hide();
                        }
                        else {
                            AcknowledgeMsg();
                            toastr.info("No Record Found!");
                        }
                    },

                });

            }
            else {
                ValidationMsg();
            }


        });


        //---------------MPO Code Name Grid----------------------


           var MainGrid = $('#MainGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: false,
                schema: {
                    model: {
                        id: "EmployeeCode",
                        fields: {
                            EmployeeCode: { type: "string" },
                            Morning: { type: "number" },
                            Evening: { type: "number" },
                            Total: { type: "number" },
                            EmployeeName: { type: "string" },
                            Designation: { type: "string" },
                            SetDate: { type: "string" },
                            Accompany: { type: "string" },
                            MarketName: { type: "string" },
                            TerritoryName: { type: "string" },
                            RegionName: { type: "string" },
                        }
                    }
                },


                pageSize: 100,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 10
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);
            },
               toolbar: [{ template: "<input type='text' id='txtGridEmployeeName'  style='float:right' placeholder='Emp Name...' class='k-textbox'>" }, { template: "<input type='text' id='txtGridEmployeeCode'  style='float:right' placeholder='Emp Code...' class='k-textbox'>" }, ],


           
            selectable: "row",
               height: 450,
               scrollable: true,
               sortable: true,
               filterable: false,
               editable: false,
               navigatable: false,
               columnMenu: false,
               reorderable: false,
            //resizable: true,
            //resize: function (e) {
            //    this.table.height(this.element.height() + this.table.height() - 1);
            //},
            columns: [
                    { field: "SL", title: "SL" },
                    { field: "EmployeeCode", title: "Employee Code" },            
                    { field: "EmployeeName", title: "Employee Name", },
                    { field: "Designation", title: "Designation", },               
                    { field: "SetDate", title: "Date"},
                    { field: "Accompany", title: "Accompany"},
                    { field: "Morning", title: "Morning" },
                    { field: "Evening", title: "Evening" },
                    { field: "Total", title: "Total" },
                    { field: "MarketName", title: "Market Name" },
                    { field: "TerritoryName", title: "Territory", },
                    { field: "RegionName", title: "Region", },
            ],
        }).data('kendoGrid');



        $("#txtGridEmployeeCode").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "EmployeeCode", operator: "contains", value: val },
          


                ]
            });
        });


        $("#txtGridEmployeeName").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [                  
                    { field: "EmployeeName", operator: "contains", value: val },
                ]
            });
        });


    });
</script>
<div class="box-header with-border">
    <form class="form" action="/ReportDcrAccompanyMpoTmRsm/Export" id="R1Form" method="post" name="H1Form" target="_blank">
   
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2"><div id="MessageText"></div></div>
            <div class="col-xs-0 col-sm-0 col-md-10 col-lg-10">
                <div style="text-align:right;">
                    <input type="checkbox" id="IsActive" class="chk" name="IsActive"> <label for="IsActive"> Hide</label>
                    <button id="btnExcel" class="btn btn-primary btn-sm" name="ExportType" value="Excel" type="submit"><i class="glyphicon glyphicon-envelope"></i> Excel </button>
                    <button id="btnPDF" class="btn btn-primary btn-sm" name="ExportType" value="PDF" type="submit"><i class="glyphicon glyphicon-book"></i> PDF </button>
                    <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-file"></i> View</button>
                </div>
            </div>
        </div>

        <div class="box-body">
            <div class="row" id="divValueParameter">
                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Date Between:</div>
                    <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">
                        <div class="input-group">
                            <input type="text" id="FromDate" name="FromDate" class="firstDay RequiredField form-control">
                            <span class="input-group-btn" style="width:0px;"></span>
                            <input type="text" id="ToDate" name="ToDate" class="date RequiredField form-control">
                            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span> </span>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3"></div>
                    <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3"> </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Designation  :</div>
                    <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">
                        <select id="Designation" name="Designation" class="RequiredField form-control">
                            <option value=""></option>
                            <option value="PM">PM</option>
                            <option value="ZM">ZM</option>
                            <option value="RM">RM</option>
                            <option value="MIO">MIO</option>

                        </select>

                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Accompany With :</div>
                    <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                        <select id="LocCode" name="LocCode" class="RequiredField form-control"></select>
                        <input type="hidden" id="LocName" name="LocName" class="RequiredField form-control">
                    </div>

                    <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">

                    </div>
                </div>

            </div>
        </div>
    </form>
</div>
<div class="row">
    <div id="MainGrid" class="MainGrid"></div>
</div>
<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p style="position: absolute; top: 50%; left: 50%; color: White;">
        <img src="~/Content/Images/loading.gif" />
    </p>
</div>

</div>