@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<link href="~/Content/CustomCSS/exportPDF.css" rel="stylesheet" />
<script src="~/Scripts/CustomJS/DefaultValue.js"></script>
<style type="text/css">
    .user-photo {
        display: inline-block;
        width: 200px;
        height: 200px;
        /*border-radius: 50%;*/
        background-size: 32px 35px;
        background-position: center center;
        vertical-align: middle;
        line-height: 32px;
        box-shadow: inset 0 0 1px #999, inset 0 0 10px rgba(0,0,0,.2);
        margin-left: 5px;
    }

    .user-name {
        display: inline-block;
        vertical-align: middle;
        line-height: 32px;
        padding-left: 3px;
    }

    .cssClass {
        background-color: red;
    }

    div#scrollTableContainer {
        width: 100%;
        table-layout: fixed;
        /*border: 1px solid black;*/
    }


    #tHeadContainer {
        background: #666633;
        color: white;
        font-size: xx-small;
        font-family: Tahoma;
        text-align: center;
        width: 98.5%;
        /*table-layout: fixed;*/
    }


    #tBodyContainer {
        min-height: 200px;
        max-height: 350px;
        width: 99.6%;
        overflow-y: scroll;
        font-size: 6pt;
        font-family: Tahoma;
        text-align: center;
        overflow-x: hidden;
        table-layout: fixed;
    }
</style>

<style>
    .k-grid .k-state-selected {
        background-color: white;
        color: black;
    }
</style>
<style>
    .has-success {
        background: white;
    }

    .has-error {
        /*background: red;*/
        border: 1px Solid red !important;
    }
</style>

<script>




    var Year = "";
    var MonthNumber = "";

    var Designation = "";
    var LocCode = "";
    var LocName = "";
    var EmployeeCode = "";
    var EmployeeName = "";
    var ReportHeader = "";

    $(document).ready(function () {
        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });

        var mNDA = "";
        var eNDA = "";
        Year = sessionStorage.getItem('keyYear');
        MonthNumber = sessionStorage.getItem('keyMonthNumber');

        LocCode = sessionStorage.getItem('keyLocCode');
        LocName = sessionStorage.getItem('keyLocName');
        EmployeeCode = sessionStorage.getItem('keyEmployeeCode');
        EmployeeName = sessionStorage.getItem('keyEmployeeName');
        Designation = sessionStorage.getItem('keyDesignation');

        ReportHeader = sessionStorage.getItem('keyReportHeader');
        $('#ReportHeader').html(ReportHeader);
        $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');

        $('#Year').val(Year);
        $('#MonthNumber').val(MonthNumber);
        $('#LocCode').val(LocCode);
        $('#LocName').val(LocName);
        $('#EmployeeCode').val(EmployeeCode);
        $('#EmployeeName').val(EmployeeName);
        $('#Designation').val(Designation);




        MainGridView();


        function MainGridView() {
            var model = {};

            model.Year = Year;
            model.MonthNumber = MonthNumber;

            model.EmployeeCode = EmployeeCode;
            model.EmployeeName = EmployeeName;
            model.Designation = Designation;
            model.LocCode = LocCode;
            model.LocName = LocName;



           
            $.ajax({
                type: "POST",
                url: "/ExpenseBillMpoTmRsm/GetDetailData",
                data: JSON.stringify({ model: model }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data.length > 0) {                      
                        $("#MainGrid").data("kendoGrid").dataSource.data(data);
                        $("#MainGrid tbody input:checkbox").prop("checked", true);
                        $("#MainGrid tbody input:checkbox").trigger("click");
                    }
                    else {
                        if (model.MasterStatus == "Waiting") {
                            toastr.info("Waiting data not found!");
                        }
                        else {
                            AcknowledgeMsg();
                            toastr.info($("#MessageText").html());
                        }

                    }
                },

            });
        }

        var MainGrid = $('#MainGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "DayNumber",
                        fields: {
                            DayNumber: { type: "string" },
                            MorningPlace: { type: "string" },
                            EveningPlace: { type: "string" },
                            AllowanceNature: { type: "string" },
                            DA: { type: "string" },
                            TA: { type: "string" },
                            TotalAmount: { type: "string" },
                            UserRemarks: { type: "string" },
                            IsHoliday: { type: "string" },
                            ApproveStatus: { type: "string" },                          
                            ReviewStatus: { type: "string", defaultValue: "No" },
                            Recommend: { type: "string" },
                        }
                    }
                },
                //pageSize: 10,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },

            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);

            },
            editable: true,
            edit: function (e) {
                $('input[name = "DayNumber"]').attr("readonly", true);
                $('input[name = "MorningPlace"]').attr("readonly", true);
                $('input[name = "EveningPlace"]').attr("readonly", true);
                $('input[name = "TotalDistince"]').attr("readonly", true);
                $('input[name = "AllowanceNature"]').attr("readonly", true);
                $('input[name = "DA"]').attr("readonly", true);
                $('input[name = "TA"]').attr("readonly", true);
                $('input[name = "UserRemarks"]').attr("readonly", true);
                $('input[name = "IsHoliday"]').attr("readonly", true);
           
                $('input[name = "ApproveStatus"]').attr("readonly", true);
                $('input[name = "ReviewStatus"]').attr("readonly", true);
                $('input[name = "Recommend"]').attr("readonly", false);
            },

            toolbar: [{ template: "<input type='text' id='txtInput'  style='float:right' placeholder='Day Number...' class='k-textbox'>" }, ],

            scrollable: true,
            sortable: true,
            columns: [

                { field: "DayNumber", title: "Day<br/>Number", width: 30 },
                {
                    title: "MORNING", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" },
                    columns: [{ field: "MorningPlace", title: "PLACE OF WORK", width: 120 }, ]
                },
                {
                    title: "EVENING", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" },
                    columns: [{ field: "EveningPlace", title: "PLACE OF WORK", width: 120 }, ]
                },

                { field: "AllowanceNature", title: "NDA", width: 50 },
                {
                    title: "EXPENSE BILL", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" },
                    columns: [
                         { field: "DA", title: "DA", width: 40 },
                         { field: "TA", title: "TA", width: 40 },
                       { field: "TotalAmount", title: "Total", width: 60, template: "<a href='javascript:void(0)' style='text-decoration: underline;' class='a:link btnLinkTotalAmount'> ${TotalAmount} </a>" },
                    ]
                },

            { field: "UserRemarks", title: "User<br/>Remarks", width: 100 },
            { field: "IsHoliday", title: "Is<br/>Holiday",  width: 80 },

             { field: "ApproveStatus", title: "Approve<br/>Status", width: 70 },
             { field: "ReviewStatus", title: "Review<br/>Status", width: 100 },
             { field: "Recommend", title: "Supervisor <br/>Remarks", width: 100 },

                { command: [{ name: "ReviewRow", text: "Review", click: handleReview }], width: 40, hidden: true, title: "Review", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 12px;text-align: center;" } },
            { command: [{ name: "RecommendRow", text: "Approve", click: handleRecommend }], width: 40, title: "Approve", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 12px;text-align: center;" } }
            ],
        }).data('kendoGrid');


        function handleRecommend(e) {

            e.preventDefault();
            var selectedItem = MainGrid.dataItem($(e.currentTarget).closest("tr"));
            var model = {};
            model.ItemList = [];
            var detail = {};
            detail.DayNumber = selectedItem.DayNumber;
            detail.Designation = $("#Designation").val();
            detail.LocCode = $("#LocCode").val();

            detail.DA = selectedItem.DA;
            detail.TA = selectedItem.TA;

            detail.TotalAmount = selectedItem.TotalAmount;
            detail.Recommend = selectedItem.Recommend;
            detail.ReviewStatus = "No"//selectedItem.ReviewStatus; sele
            detail.MonthNumber = $('#MonthNumber').val();
            detail.Year = $('#Year').val();
            model.ItemList.push(detail);

            $.ajax({
                url: '/ExpenseBillMpoTmRsm/OperationsModeDateWiseRecommend',
                data: JSON.stringify(model),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    if (data.Status == "Yes") {
                        OperationMsg(data.Mode);
                        toastr.success($("#MessageText").html());
                    }
                    else {
                        ErrorFrmServerMsg(data.Status);
                        toastr.warning($("#MessageText").html());
                    }

                },
                error: function () {
                    ErrorFrmClientMsg();
                    toastr.warning($("#MessageText").html());
                },
                // complete: function () { CompletedMsg(); },
            }); //End of ajax call



        };
        function handleReview(e) {

            e.preventDefault();
            var selectedItem = MainGrid.dataItem($(e.currentTarget).closest("tr"));


            if (selectedItem.Recommend != "" && selectedItem.Recommend != null) {
                var model = {};
                model.ItemList = [];

                var detail = {};

                detail.DayNumber = selectedItem.DayNumber;

               
                detail.LocCode = $("#LocCode").val();
                detail.Designation = $("#Designation").val();

                detail.DA = selectedItem.DA;
                detail.TA = selectedItem.TA;

                detail.TotalAmount = selectedItem.TotalAmount;
                detail.Recommend = selectedItem.Recommend;
                detail.ReviewStatus = "Yes";
                detail.MonthNumber = $('#MonthNumber').val();
                detail.Year = $('#Year').val();
                model.ItemList.push(detail);

                $.ajax({
                    url: '/ExpenseBillMpoTmRsm/OperationsModeDateWiseRecommend',
                    data: JSON.stringify(model),
                    type: 'POST',
                    contentType: 'application/json;',
                    dataType: 'json',
                    success: function (data) {
                        if (data.Status == "Yes") {
                            OperationMsg(data.Mode);
                            toastr.success($("#MessageText").html());
                        }
                        else {
                            ErrorFrmServerMsg(data.Status);
                            toastr.warning($("#MessageText").html());
                        }

                    },
                    error: function () {
                        ErrorFrmClientMsg();
                        toastr.warning($("#MessageText").html());
                    },
                    // complete: function () { CompletedMsg(); },
                }); //End of ajax call

            }
            else {
                ValidationMsg();
                toastr.info($("#MessageText").html());
            }

        };
        //function onDataBoundRemoveEvening(e) {
        //    var grid = $("#MainGrid").data("kendoGrid");
        //    var gridData = grid.dataSource.view();
        //    for (var i = 0; i < gridData.length; i++) {
        //        var currentUid = gridData[i].uid;
        //        if (TA == "151") {
        //            alert(Okay);
        //            $("#MainGrid").find(".RemoveEnableDisable").addClass(cssClass);
        //        }
        //    }
        //}

        function onDataBoundColor(e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var gridData = grid.dataSource.view();
            for (var i = 0; i < gridData.length; i++) {
                var currentUid = gridData[i].uid;
                if (gridData[i].ImageLink == "Yes") {
                    //var currentRow = grid.table.find("tr[data-uid='" + currentUid + "']");
                    //currentRow.css('background-color', 'red');
                    var currentRow = grid.table.find("tr[data-uid='" + currentUid + "'] td:nth-child(17)");
                    currentRow.css('background-color', 'green');
                    // $('tr[data-uid="' + row.uid + '"] td:nth-child(5)').css("background-color", "red");
                }
            }
        }
        $("#txtInput").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [

                    { field: "DayNumber", operator: "contains", value: val },
                  

                ]
            });
        });
        var dtReviewStatus = [{ text: "No", value: "No" }, { text: "Yes", value: "Yes" }];
        //Setting Kendo drop down with above mentioned data
        function ddlReviewStatus(container, options) {
            $('<input id="ReviewStatus"  data-text-field="text" data-value-field="value" data-bind="value:' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList({
                        autoBind: true,
                        //suggest: true,
                        dataTextField: "text",
                        dataValueField: "value",
                        dataSource: dtReviewStatus
                    });
        };





        //$("#MainGrid").on("click", ".btnImageLink", function (e) {

        //    var gridData = $("#MainGrid").data("kendoGrid");
        //    var selectedItem = (gridData.dataItem(gridData.select()));

        //    var model = {};
        //    model.Year = $("#Year").val();
        //    model.MonthNumber = $("#MonthNumber").val();
        //    model.TerritoryManagerID = $("#TerritoryManagerID").val();
        //    model.MPGroup = $("#MPGroup").val();
        //    model.DayNumber = selectedItem.DayNumber;
        //    $('#tImage').html('');
        //    ImagePopupWindow.center();
        //    ImagePopupWindow.open();
        //    var ipAddress = "http://202.59.140.108:128/";

        //    $.ajax({
        //        type: "POST",
        //        url: '/ExpenseBillMpo/GetImage',
        //        data: JSON.stringify({ model: model }),
        //        contentType: "application/json; charset=utf-8",
        //        dataType: "json",
        //        success: function (data) {
        //            if (data != "") {
        //                $.each(data, function (i, val) {


        //                    ipAddress = ipAddress + val.ImagePath;
        //                    var trow = $('<tr></tr>');
        //                    trow.append('<td >' + val.ImageName + '</td>');
        //                    trow.append('<td> <img class=user-photo src =' + ipAddress + ' /></td>');
        //                    $('#tImage').append(trow);

        //                })
        //            }
        //            else {

        //                ImagePopupWindow.close();
        //                AcknowledgeMsg();
        //                toastr.info($("#MessageText").html());
        //            }

        //        },
        //        error: function () {
        //            alert('Error occured!');
        //        },

        //    });

        //});

        var TAPopupWindow = $("#TAPopupWindow").kendoWindow({
            width: "60%",
            draggable: true,
            modal: true,
            resizable: true,
            title: "List",
        }).data("kendoWindow");

       







        $("#MainGrid").on("click", ".btnLinkTotalAmount", function (e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));

            $('#MAllowence').empty();
            $('#EAllowence').empty();
            var model = {};
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();

            model.LocCode = $("#LocCode").val();
            model.EmployeeCode = $("#EmployeeCode").val();
            model.Designation = $("#Designation").val();
            model.DayNumber = dataItem.DayNumber;
            $("#DayNumber").val(dataItem.DayNumber);
            GetDAM();
            GetDAE();


            debugger;
            var nameArr = dataItem.AllowanceNature.split(',');
            mNDA = nameArr[0].toString().trim();
            eNDA = nameArr[0].toString().trim();
            if (nameArr.length>1)
            {
                eNDA =nameArr[1].toString().trim();
            }

        
            $('#DivNDA').html('NDA: ' + dataItem.AllowanceNature + ' & DA: ' + dataItem.DA).css('color', 'green');


            $("#DA").val(dataItem.DA);
            $("#chkHolidayWork").prop('checked', false);

            if (dataItem.IsHoliday == "Yes")
            {
                $("#chkHolidayWork").prop('checked', true);
            }
            TAPopupWindow.center();
            TAPopupWindow.open();

            $.ajax({
                url: '/ReportExpenseBillMpoTmRsm/GetTA',
                data: JSON.stringify(model),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    $.each(data, function (i, item) {
                        $("#MasterSL").val(item.MasterSL);
                        $("#RegionCode").val(item.RegionCode);
                        $("#RegionType").val(item.RegionType);
                        $("#cmbRegionType").val(item.cmbRegionType);
                        $("#RegionRate").val(item.RegionRate);
                        $("#MileageRate").val(item.MileageRate);
                        $("#FuelRate").val(item.FuelRate);
                        $("#Distance").val(item.Distance);
                        $("#TA").val(item.TA);
                    });
                },
                error: function () {
                    alert('Error occured!');
                },
            });

            $("#Distance").prop("readonly", false);
            if ($("#RegionType").val() == "MC" || $("#RegionType").val()  == "City") {
                $("#Distance").prop("readonly", true);
            }
            //$('#EAllowence').on('change', function () { }).trigger('change');
            //$('#MAllowence').on('change', function () { }).trigger('change');


        });
        $('#cmbRegionType').on('change', function () {

            $("#Distance").prop("readonly", true);
            $("#TA").prop("readonly", true);

            if ($(this).val() == "MCCity") {

                if ($("#MAllowence option:selected").html() != "NA" && $("#EAllowence option:selected").html() != "NA") {

                    var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                    $("#TA").val(ta);
                    $("#Distance").val(1);
                    $("#Distance").prop("readonly", true);
                }
                else if ($("#MAllowence option:selected").html() != "NA") {

                    var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                    ta = ta / 2;
                    $("#TA").val(ta.toFixed(2));
                    $("#Distance").val(1);
                    $("#Distance").prop("readonly", true);
                }
                else if ($("#EAllowence option:selected").html() != "NA") {

                    var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                    ta = ta / 2;
                    $("#TA").val(ta.toFixed(2));
                    $("#Distance").val(1);
                    $("#Distance").prop("readonly", true);
                }
                else {

                    $("#TA").val(0);
                    $("#Distance").val(0);
                    $("#Distance").prop("readonly", false);
                    $("#TA").prop("readonly", false);
                }
            }
            else {

                if ($("#MAllowence option:selected").html() == "NA" && $("#EAllowence option:selected").html() == "NA") {
                    $("#TA").val(0);
                    $("#Distance").val(0);
                    $("#Distance").prop("readonly", false);
                    $("#TA").prop("readonly", false);
                }
                else {
                    $("#TA").val(0);
                    $("#Distance").val(0);
                    $("#Distance").prop("readonly", false);
                    $("#TA").prop("readonly", false);
                }
            }
        });

        $('#Distance').on('keyup', function () {
            //if ($('#Distance').val() > 1) {
            //    var Total = $("#Distance").val() * $("#MileageRate").val() * $("#FuelRate").val();
            //    $("#TA").val(parseFloat(Total).toFixed(2));
            //}
            //else { //City or MC
            //    var Total = 1 * $("#RegionRate").val() * $("#FuelRate").val();
            //    $("#TA").val(parseFloat(Total).toFixed(2));
            //}
            if ($("cmbRegionType").val() == "MCCity")
            {
                var Total = 1 * $("#RegionRate").val() * $("#FuelRate").val();
                $("#TA").val(parseFloat(Total).toFixed(2));
            }
            else { //City or MC
                var Total = $("#Distance").val() * $("#MileageRate").val() * $("#FuelRate").val();
                $("#TA").val(parseFloat(Total).toFixed(2));
            }
        });

      
        $('#MAllowence').on('change', function () {
        
                var Total = parseFloat($("#MAllowence").val()) + parseFloat($("#EAllowence").val());
                $("#DA").val(Total.toFixed(2));

                $('#chkHolidayWork').prop('checked', false);
                var isTrue = $('#chkHolidayWork').is(':checked');


            if ($("#MAllowence option:selected").text() == "NA")
            {
                if ($("#EAllowence option:selected").text() == "NA") {
                    $("#TA").val(0);
                    $("#Distance").val(0);
                    $("#Distance").prop("readonly", true);
                    $("#TA").prop("readonly", true);
                }
                else
                {
                    if ($("#cmbRegionType").val() == "MCCity") {
                        var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                        ta = ta / 2;
                        $("#TA").val(ta.toFixed(2));
                        $("#Distance").val(1);
                        $("#Distance").prop("readonly", true);
                    }
                }
            }
            else {//if ($("#MAllowence option:selected").html() != "NA")

                if ($("#EAllowence option:selected").text() == "NA") {
                    {

                        if ($("#cmbRegionType").val() == "MCCity") {
                            var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                            ta = ta / 2;
                            $("#TA").val(ta.toFixed(2));
                            $("#Distance").val(1);
                            $("#Distance").prop("readonly", true);
                        }
                    }
                }

                else {

                    if ($("#cmbRegionType").val() == "MCCity") {
                        var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                        ta = ta / 2;
                        $("#TA").val(ta.toFixed(2));
                        $("#Distance").val(1);
                        $("#Distance").prop("readonly", true);
                    }
                }
            }
        });


        $('#EAllowence').on('change', function () {
            var Total = parseFloat($("#MAllowence").val()) + parseFloat($("#EAllowence").val());
            $("#DA").val(Total.toFixed(2));

            $('#chkHolidayWork').prop('checked', false);
            var isTrue = $('#chkHolidayWork').is(':checked');


            if ($("#EAllowence option:selected").text() == "NA") {
                if ($("#MAllowence option:selected").text() == "NA") {
                    $("#TA").val(0);
                    $("#Distance").val(0);
                    $("#Distance").prop("readonly", true);
                    $("#TA").prop("readonly", true);
                }
                else {
                    if ($("#cmbRegionType").val() == "MCCity") {
                        var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                        ta = ta / 2;
                        $("#TA").val(ta.toFixed(2));
                        $("#Distance").val(1);
                        $("#Distance").prop("readonly", true);
                    }
                }
            }
            else {//if ($("#EAllowence option:selected").html() != "NA")

                if ($("#MAllowence option:selected").text() == "NA") {
                     {

                        if ($("#cmbRegionType").val() == "MCCity") {
                            var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                            ta = ta / 2;
                            $("#TA").val(ta.toFixed(2));
                            $("#Distance").val(1);
                            $("#Distance").prop("readonly", true);
                        }
                    }
                }

                else {

                    if ($("#cmbRegionType").val() == "MCCity") {
                        var ta = 1 * $("#FuelRate").val() * $("#RegionRate").val();
                        ta = ta / 2;
                        $("#TA").val(ta.toFixed(2));
                        $("#Distance").val(1);
                        $("#Distance").prop("readonly", true);
                    }
                }
            }
        });


        function GetDAM() {
            var valDefault = "";
             var model = {};
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.DayNumber = $("#DayNumber").val();
            model.LocCode = $("#LocCode").val();
            model.EmployeeCode = $("#EmployeeCode").val();
            model.Designation = $("#Designation").val();
            $.ajax({
                url: '/ReportExpenseBillMpoTmRsm/GetDA',
                data: JSON.stringify(model),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    //$('#MAllowence').empty();
                    $.each(data, function (i, item) {
                        debugger;
                        $('#MAllowence').append($('<option>', { value: item.AllowenceRate, html: item.Allowence }, '<option/>'));
                        if (item.Allowence == mNDA) {
                            valDefault = item.AllowenceRate;
                  
                        }
                        $('#MAllowence').val(valDefault);
                      
                    });

                },
                error: function () {
                    alert('Error occured!');
                },
            });
        }
        function GetDAE() {
            var valDefault = "";
            var model = {};
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.DayNumber = $("#DayNumber").val();
            model.LocCode = $("#LocCode").val();
            model.EmployeeCode = $("#EmployeeCode").val();
            model.Designation = $("#Designation").val();
            $.ajax({
                url: '/ReportExpenseBillMpoTmRsm/GetDA',
                data: JSON.stringify(model),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    //$('#EAllowence').empty();
                    $.each(data, function (i, item) {
                        $('#EAllowence').append($('<option>', { value: item.AllowenceRate, html: item.Allowence }, '<option/>'));
                        debugger;
                        if (item.Allowence == eNDA) {
                            valDefault = item.AllowenceRate;
                         
                        }
                        $('#EAllowence').val(valDefault);
                     
                    });

                },
                error: function () {
                    alert('Error occured!');
                },
            });
        }


        $('#chkHolidayWork').click(function () {
            if ($(this).is(':checked')) {
                var Total = parseFloat($("#MAllowence").val()) + parseFloat($("#EAllowence").val());
                Total = Total * 1.5;
                $("#DA").val(parseFloat(Total).toFixed(2));
            }
            else {
                var Total = parseFloat($("#MAllowence").val()) + parseFloat($("#EAllowence").val());
                $("#DA").val(parseFloat(Total).toFixed(2));
            }
        });
        $('#btnSaveTA').click(function () {

            var model = {};

            model.IsHoliday = "No";
            var isTrue = $('#chkHolidayWork').is(':checked');
            if (isTrue==true) {

                model.IsHoliday = "Yes";
            }

            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.LocCode = $("#LocCode").val();
            model.EmployeeCode = $("#EmployeeCode").val();
            model.Designation = $("#Designation").val();

            //alert($("#LocCode").val());

            model.MAllowence = $("#MAllowence option:selected").text();
            model.EAllowence = $("#EAllowence option:selected").text();
            model.DA = $("#DA").val();
            model.Remarks = $("#Remarks").val();

            model.MasterSL = $("#MasterSL").val();
            model.RegionCode = $("#RegionCode").val();
            //model.RegionType = $("#cmbRegionType").val();
            model.RegionType = $("#RegionType").val();
            model.RegionRate = $("#RegionRate").val();
            model.MileageRate = $("#MileageRate").val();
            model.FuelRate = $("#FuelRate").val();

            model.Distance = $("#Distance").val();
            model.TA = $("#TA").val();


            var Input = InputValidation('TA') + InputValidation('DA') + InputValidation('Remarks');
            if (Input == 0) {


                $.ajax({
                    url: '/ExpenseBillMpoTmRsm/OperationsModeDaTa',
                    data: JSON.stringify(model),
                    type: 'POST',
                    contentType: 'application/json;',
                    dataType: 'json',
                    success: function (data) {
                        if (data.Status == "Yes") {
                            OperationMsg(data.Mode);
                            toastr.success($("#MessageText").html());
                            MainGridView();
                            TAPopupWindow.close();
                        }
                        else {
                            ErrorFrmServerMsg(data.Status);
                            toastr.warning($("#MessageText").html());
                        }

                    },
                    error: function () {
                        ErrorFrmClientMsg();
                        toastr.warning($("#MessageText").html());
                    },
                    // complete: function () { CompletedMsg(); },
                }); //End of ajax call

            }

            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }

            //location.reload();
        });


        var gridInput = 0;
        function GridValidation() {
            gridInput = 0;
            var dataSource = $("#MainGrid").data("kendoGrid").dataSource;
            data = dataSource.data(); // Get Detail Grid Data
            if (dataSource.view().length > 0) {
                for (var i = data.length - 1; i >= 0; i--) {
                    if (data[i].DayNumber == "" || data[i].DayNumber == null) {
                        gridInput = 1;
                    }
                }
            }
            else {
                gridInput = 1;
            }
        }

        function fnClose() {
            this.close();
        }
        $('#btnSave').click(function () {

            GridValidation();
            var model = {};



            var detailDataSource = $('#MainGrid').data("kendoGrid").dataSource;
            var detailData = detailDataSource.data();
            model.ItemList = [];
            if (gridInput == 0 > 0) {

                if (detailData.length > 0) {
                    for (var i = 0; i < detailData.length; i++) {
                        var detail = {};

                        detail.DayNumber = detailData[i].DayNumber;
                        detail.MorningPlace = detailData[i].MorningPlace;
                        detail.EveningPlace = detailData[i].EveningPlace;

                        detail.TotalDistince = detailData[i].TotalDistince;
                        detail.AllowanceNature = detailData[i].AllowanceNature;
                        detail.DA = detailData[i].DA;
                        detail.TA = detailData[i].TA;
                        detail.UserRemarks = detailData[i].UserRemarks;
                        detail.IsHoliday = detailData[i].IsHoliday;
                        detail.ReviewStatus = detailData[i].ReviewStatus;
                        detail.Recommend = detailData[i].Recommend;
                        detail.MonthNumber = $('#MonthNumber').val();
                        detail.Year = $('#Year').val();
                        detail.LocCode = $('#LocCode').val();
                        detail.EmployeeCode = $("#EmployeeCode").val();
                        detail.Designation = $("#Designation").val();
                        model.ItemList.push(detail);
                    }
                }



                $.ajax({
                    url: '/ExpenseBillMpoTmRsm/OperationsModeDetail',
                    data: JSON.stringify(model),
                    type: 'POST',
                    contentType: 'application/json;',
                    dataType: 'json',
                    success: function (data) {
                        if (data.Status == "Yes") {
                            OperationMsg(data.Mode);
                            toastr.success($("#MessageText").html());

                            fnClose();
                        }
                        else {
                            ErrorFrmServerMsg(data.Status);
                            toastr.warning($("#MessageText").html());
                        }

                    },
                    error: function () {
                        ErrorFrmClientMsg();
                        toastr.warning($("#MessageText").html());
                    },
                    // complete: function () { CompletedMsg(); },
                }); //End of ajax call

            }

            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }

        });
        $('#btnBack').click(function () {
            fnClose();

        });
    });


</script>



<div class="box-header with-border">
    <form class="form" action="/ReportExpenseBillMpoTmRsm/ExportDetail" id="R1Form" method="post" name="H1Form" target="_blank">

        <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2"><div id="MessageText"></div></div>
        <div class="col-xs-0 col-sm-0 col-md-10 col-lg-10">
            <div style="text-align:right;">
                <button id="btnExcel" class="btn btn-primary btn-sm" name="ExportType" value="Excel" type="submit"><i class="glyphicon glyphicon-envelope"></i> Excel </button>
                <button id="btnPDF" class="btn btn-primary btn-sm" name="ExportType" value="PDF" type="submit"><i class="glyphicon glyphicon-book"></i> PDF </button>

                <button id="btnSave" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-ok-circle"></i>All Approve</button>
                <button id="btnBack" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-backward"></i>Back</button>
            </div>
        </div>


        <div class="box-body">
            <div class="row">
                <div style="text-align:left"> <span style="background-color: #666633;color: white;" id="ReportHeader"></span></div>
            </div>

            <div class="row">
                <div style="display:none">
                    <input type="text" id="Year" name="Year">
                    <input type="text" id="MonthNumber" name="MonthNumber">
                    <input type="text" id="LocCode" name="LocCode">
                    <input type="text" id="LocName" name="LocName">
                    <input type="text" id="Designation" name="Designation">
                    <input type="text" id="EmployeeCode" name="EmployeeCode">
                    <input type="text" id="EmployeeName" name="EmployeeName">
                </div>

            </div>
        </div>
    </form>

    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div id="MainGrid" class="MainGrid"></div>
        </div>
    </div>

    <div id="TAPopupWindow" class="PopupWindowLayout" style="display: none;">
        <div class="row">
            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                <div id="DivNDA" style="text-align: center;"> </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                <div class="input-group">
                    <span class="input-group-addon">Morning DA:</span>
                    <span class="input-group-addon">
                        <select id="MAllowence" name="MAllowence" class="RequiredField form-control">
                        </select>
                    </span>
                    <span class="input-group-addon">Evening DA:</span>
                    <span class="input-group-addon">
                        <select id="EAllowence" name="EAllowence" class="RequiredField form-control">
                        </select>
                    </span>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                <div class="input-group">
                    <span class="input-group-addon"><input type="hidden" id="MasterSL"></span>
                    <span class="input-group-addon">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span class="input-group-addon">
                        <input type="checkbox" id="chkHolidayWork" class="chk" name="chkHolidayWork"> <label for="IsActive"> Holiday Work</label>
                    </span>

                    <span class="input-group-addon">Total DA:</span>
                    <span class="input-group-addon"><input type="text" id="DA" name="DA" readonly></span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                <div class="input-group">
                    <span class="input-group-addon">Region Type:</span>
                    <span class="input-group-addon">
                        <select id="cmbRegionType" name="cmbRegionType" class="RequiredField form-control">
                            <option value="MCCity">MC/City</option>
                            <option value="Mileage">Mileage</option>
                        </select>
                    </span>
                    <span class="input-group-addon">Distance:</span>
                    <span class="input-group-addon"><input type="number" id="Distance" name="Distance" style="width:70%"></span>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                <div class="input-group">
                    <span class="input-group-addon">Total TA:</span>
                    <span class="input-group-addon"><input type="text" id="TA" name="TA" readonly></span>
                    <span class="input-group-addon">Remarks:</span>
                    <span class="input-group-addon"><input type="text" id="Remarks" name="Remarks"></span>

                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
                <div class="input-group">
                    <span class="input-group-addon"><input type="hidden" id="DayNumber"></span>
                    <span class="input-group-addon"><input type="hidden" id="RegionCode"></span>
                    <span class="input-group-addon"><input type="hidden" id="RegionType"></span>
                    <span class="input-group-addon"><input type="hidden" id="RegionRate"></span>
                    <span class="input-group-addon"><input type="hidden" id="MileageRate"></span>
                    <span class="input-group-addon"><input type="hidden" id="FuelRate"></span>
                    <span class="input-group-addon"><button id="btnSaveTA" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-save-file"></i>Save</button></span>
                </div>
            </div>
        </div>
    </div>
</div>






    


    <div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
        <p style="position: absolute; top: 50%; left: 50%; color: White;">
            <img src="~/Content/Images/loading.gif" />
        </p>
    </div>







