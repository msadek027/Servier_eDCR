
@{
    //ViewBag.Title = "frmImportExcelToGrid";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .p-0 {
        padding: 0 !important;
    }

    .pt-5 {
        padding-top: 5px !important;
    }
</style>
<div class="box-header with-border">
    @*Form Title*@
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4"> <div id="MessageText"></div></div>
        <div class="col-xs-0 col-sm-0 col-md-8 col-lg-8">
            <div style="text-align:right;">
                <button id="btnTemplateDownload" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-refresh"></i> Template</button>

                <button id="btnReset" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-refresh"></i> Reset</button>
                <button id="btnExcel" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-envelope"></i> Excel </button>
                @*<button id="btnSave" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-save-file"></i> Save</button>*@
                <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-file"></i> View</button>
            </div>
        </div>
    </div>
</div>
<div class="box-body">
    <div class="row">
        <div class="col-xs-6 col-sm-6 col-md-8">
            <div class="col-sm-6 col-md-2 p-0 pt-5">Month -Year:</div>
            <div class="col-sm-6 col-md-6">
                <div class="input-group">
                    <select id="MonthNumber" name="MonthNumber" class=" RequiredField form-control"></select>
                    <span class="input-group-btn" style="width:2px;"></span>
                    <input type="text" id="Year" class="datepicker RequiredField form-control" />
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Doctor ID:</div>
            <div class="col-sm-6 col-md-8">
                <input id="DoctorID" name="DoctorID" class="RequiredField form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Doctor Name:</div>
            <div class="col-sm-6 col-md-8">
                <input id="DoctorName" name="DoctorName" class="RequiredField form-control" required />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Degrees:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Degrees" name="Degrees" class="form-control" />
            </div>
        </div>


        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Specialization:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Specialization" name="Specialization" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Potential:</div>
            <div class="col-sm-6 col-md-8">
                <select id="Potential" name="Potential" class="form-control">
                    <option value="">Select One...</option>
                    <option value="Low to Medium">Low to Medium</option>
                    <option value="Medium to High">Medium to High</option>
                    <option value="High to High">High to High</option>
                </select>
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Designation:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Designation" name="Designation" class="form-control" />
            </div>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Reg No:</div>
            <div class="col-sm-6 col-md-8">
                <input id="RegNo" name="RegNo" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Phone:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Phone" name="Phone" type="tel" pattern="[+]{1}[0-9]{11,14}" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Email:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Email" name="Email" type="email" class="form-control" />
            </div>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Religion:</div>
            <div class="col-sm-6 col-md-8">
                <select id="Religion" name="Religion" class="form-control">
                    <option value="">Select One...</option>
                    <option value="Islam">Islam</option>
                    <option value="Hinduism">Hinduism</option>
                    <option value="Christianity">Christianity </option>
                    <option value="Buddhism">Buddhism</option>
                </select>
                @*<input id="Religion" name="Religion" class="form-control" />*@
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Gender:</div>
            <div class="col-sm-6 col-md-8">
                <select id="Gender" name="Gender" class="form-control">
                    <option value="Male">Male</option>
                    <option value="Femal">Female</option>
                    <option value="Other">Other</option>
                </select>
                @*<input id="Gender" name="Gender" class="form-control" />*@
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Adoption:</div>
            <div class="col-sm-6 col-md-8">
                <select id="Adoption" name="Adoption" class="form-control">
                    <option value="">Select One...</option>
                    <option value="Undecided/Unaware">Undecided/Unaware</option>
                    <option value="Trialist">Trialist</option>
                    <option value="Conscious Non-Prescriber">Conscious Non-Prescriber</option>
                    <option value="Medium prescriber">Medium prescriber</option>
                    <option value="High to high Prescriber">High to high Prescriber</option>
                </select>
            </div>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Product Group:</div>
            <div class="col-sm-6 col-md-8">
                <select id="ProductGroup" name="ProductGroup" class="form-control">
                    <option value="">Select One...</option>
                    <option value="A">A</option>
                    <option value="G">G</option>
                    <option value="GA">GA</option>
                    <option value="R">R</option>
                </select>
            </div>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Team Target:</div>
            <div class="col-sm-6 col-md-8">
                <input id="TeamTarget" name="TeamTarget" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Market:</div>
            <div class="col-sm-6 col-md-8">
                <select id="MarketCode" name="MarketCode" class="RequiredField form-control">
                    <option value=""></option>
                </select>
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Region:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Region" name="Region" class="form-control" />
            </div>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Address1:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Address1" name="Address1" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Address2:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Address2" name="Address2" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Address3:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Address3" name="Address3" class="form-control" />
            </div>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Address4:</div>
            <div class="col-sm-6 col-md-8">
                <input id="Address4" name="Address4" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Morning Location:</div>
            <div class="col-sm-6 col-md-8">
                <input id="MorningLocation" name="MorningLocation" class="form-control" />
            </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-sm-6 col-md-4 p-0 pt-5">Evening Location:</div>
            <div class="col-sm-6 col-md-8">
                <input id="EveningLocation" name="EveningLocation" class="form-control" />
            </div>
        </div>
        <div class="col-md-4"></div>
        <div class="col-xs-6 col-sm-6 col-md-4">
            <div class="col-md-4"></div>
            <div class="col-md-8">
                <button id="btnSaveSingle" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-floppy-disk"></i> Save Single</button>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <br />
    <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2"><label for="myfile">Or Upload from Excel:</label></div>
        <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">
            <input type="file" id="myfile" name="myfile" class="files btn btn-primary btn-sm" accept=".xlsx"><br><br>
        </div>
        <div class="col-xs-0 col-sm-0 col-md-2 col-lg-2">
            <button id="btnSave" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-floppy-disk"></i> Save All</button>
        </div>
        <div class="col-xs-0 col-sm-0 col-md-2 col-lg-2"></div>
        <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3"></div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div id="MainGrid" class="MainGrid">
                <div class="k-loading-mask" style="width:100%;height:100%">
                    <span class="k-loading-text">Loading...</span>
                    <div class="k-loading-image">
                        <div class="k-loading-color">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p style="position: absolute; top: 50%; left: 50%; color: White;">
        <img src="~/Content/Images/loading.gif" />
    </p>
</div>

<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<script src="~/Scripts/xlsx_0.7.12_xlsx.full.min.js"></script>
<script type="text/javascript">

    //// Start  $(document).ready(function ()
    $(document).ready(function () {

        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });

        //upload change event
        $("#myfile").change(function (evt) {

            var file = evt.target.files[0] //retrieve the uploaded file
            fnConvertExcelToJSON(file)
        })
        function fnConvertExcelToJSON(file) { //method to convert excel to json
            var reader = new FileReader()
            reader.onload = function (event) {
                var data = event.target.result
                var workbook = XLSX.read(data, {
                    type: 'binary'
                });
                var json_object
                workbook.SheetNames.forEach(function (sheetName) {
                    var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName])
                    json_object = JSON.stringify(XL_row_object)
                    var jsonOutput = JSON.stringify(JSON.parse(json_object), undefined, 4)
                    // $('#jsonText').html(jsonOutput);
                    //alert(jsonOutput.length);
                    debugger;

                    var obj = JSON.parse(jsonOutput);

                    console.log(jsonOutput);

                    $("#MainGrid").data("kendoGrid").dataSource.data(obj);


                    toastr.success("Data uploaded on grid");
                })
            }
            reader.onerror = function (event) {
                console.error("File could not be read! Code " + event.target.error.code)
            }
            reader.readAsBinaryString(file);
        }

        $(".k-loading-mask").hide();


        //EventPermission();

        $(".datepicker").datepicker({
            format: " yyyy",
            viewMode: "years",
            minViewMode: "years",
            autoclose: true
        });
        $("#Year").val(yyyy);
        LoadMonth();
        function LoadMonth() {

            $.ajax({
                url: '@Url.Action("GetGenMonth", "Default")',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#MonthNumber').append($('<option>', { value: item.MonthNumber, html: item.MonthName }, '<option/>'));
                    });
                },
                error: function () {
                    alert("Failed to load !!");
                }
            });
        }
        LoadMarket();
        var markets = [];
        function LoadMarket() {
            $.ajax({
                url: '@Url.Action("GetMarkets", "DoctorDataUpload")',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    markets = data;
                    $.each(data, function (i, item) {
                        $('#MarketCode').append($('<option>', { value: item.MarketCode, html: item.MarketCode + " - " + item.Market }, '<option/>'));
                    });
                },
                error: function () {
                    alert("Failed to load !!");
                }
            });
        }

        $('#btnTemplateDownload').click(function () {
            $.ajax({
                url: '/DoctorDataUpload/TemplateDownload',
                method: 'POST',
                data: JSON.stringify({}),
                dataType: 'JSON',
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    if (data != "") {
                        window.location.href = "/DoctorDataUpload/Download/?fileName=" + data.fileName;
                    }
                    else {
                        AcknowledgeMsg();
                        toastr.warning($("#MessageText").html());
                    }

                },
                error: function () {
                    alert('Error occured!');
                },
            });
        });
        $('#btnReset').click(function () {
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

            $("#myfile").val('');
            $(".txtBox").css("border-color", "");
            $(".k-upload-files").remove();
            $(".k-upload-status").remove();
            $(".k-upload.k-header").addClass("k-upload-empty");
            $(".k-upload-button").removeClass("k-state-focused");
            ResetData();
        });


        function ResetData() {
            //$("#Year").val('');
            //$("#MonthNumber").val('');
            $("#Region").val('');
            $("#MarketName").val('');
            $("#DoctorID").val('');
            $("#DoctorName").val('');
            $("#RegNo").val('');
            $("#Phone").val('');
            $("#Email").val('');
            $("#Address").val('');
            $("#Address1").val('');
            $("#Address2").val('');
            $("#Address3").val('');
            $("#Address4").val('');
            $("#MarketCode").val('');
            $("#Religion").val('');
            $("#Designation").val('');
            $("#Specialization").val('');
            $("#Potential").val('');
            $("#Degrees").val('');
            $("#Gender").val('');
            $("#MorningLocation").val('');
            $("#EveningLocation").val('');
            $("#Market").val('');
            $("#ProductGroup").val('');
            $("#Adoption").val('');
            $("#TeamTarget").val('');
        }
        $('#btnExcel').click(function () {
            $("#MainGrid").getKendoGrid().saveAsExcel();
        });
        //***************view function*****************
        $('#btnView').click(function () {

            var model = {};

            model.MonthNumber = $('#MonthNumber').val();
            model.Year = $('#Year').val();

            var loader = $(".k-loading-mask").show();
            if (loader) {
                $('#MainGrid').data('kendoGrid').dataSource.filter([]);
                $('#MainGrid').data('kendoGrid').dataSource.data([]);
                $('#btnReset').attr('disabled', true);
                $('#btnSave').attr('disabled', true);
                $('#btnView').attr('disabled', true);
                var Input = InputValidation('MonthNumber') + InputValidation('Year');
                if (Input == 0) {
                    GetGridData(model);
                }
                else {
                    ValidationMsg();
                    toastr.warning($("#MessageText").html());
                }
            }
            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }

        });

        //**************searching function**************
        function GetGridData(model) {

            $.ajax({
                type: "POST",
                url: "/DoctorDataUpload/GetGridData",
                data: JSON.stringify({ model: model }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data != "") {
                        $("#MainGrid").data("kendoGrid").dataSource.data(data);
                        $(".k-loading-mask").hide();
                        $('#btnReset').attr('disabled', false);
                        $('#btnSave').attr('disabled', false);
                        $('#btnView').attr('disabled', false);
                    }
                    else {
                        AcknowledgeMsg();
                        toastr.warning("No Record Found!");

                    }
                },

            });
        }

        //************************************ Doctor KENDO GRID *****************************************//

        //Initializing Main page details Kendo Grid Colums
        var MainGrid = $('#MainGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "DoctorID",
                        fields: {
                            DoctorID: { type: "string" },
                            DoctorName: { type: "string" },
                            Degrees: { type: "string" },
                            Specialization: { type: "string" },
                            Potential: { type: "string" },
                            Designation: { type: "string" },
                            RegNo: { type: "string" },
                            Phone: { type: "string" },
                            Email: { type: "string" },
                            Religion: { type: "string" },
                            Gender: { type: "string" },

                            Address1: { type: "string" },
                            Address2: { type: "string" },
                            Address3: { type: "string" },
                            Address4: { type: "string" },
                            MorningLocation: { type: "string" },
                            EveningLocation: { type: "string" },

                            MarketCode: { type: "string" },
                            Market: { type: "string" },
                            Region: { type: "string" },
                        }
                    }
                },
                pageSize: 10,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);
            },
            edit: function (e) {
                $('input[name = "DoctorID"]').attr("readonly", true);

            },
            scrollable: true,
            sortable: true,
            filterable: false,
            editable: false,
            selectable: "row",
            //selectable: "multiple",
            toolbar: [{ template: "<input type='text' id='txtMorningLocation'  style='float:right' placeholder='M/E Location ...' class='k-textbox'>" }, { template: "<input type='text' id='txtMarketCode'  style='float:right' placeholder='Market Code ...' class='k-textbox'>" }, { template: "<input type='text' id='txtMarketName'  style='float:right' placeholder='Market Name ...' class='k-textbox'>" }, { template: "<input type='text' id='txtDoctorName'  style='float:right' placeholder='Doctor Name ...' class='k-textbox'>" }, { template: "<input type='text' id='txtDoctorId'  style='float:right' placeholder='Doctor Id ...' class='k-textbox'>" }, ],
            excel: {
                fileName: "DoctorData.xlsx",
                allPages: true,
                filterable: true
            },
            navigatable: true,
            height: 400,
            columnMenu: false,
            reorderable: true,
            resizable: true,
            resizable: true,
            resize: function (e) {
                this.table.height(this.element.height() + this.table.height() - 1);
            },
            columns: [
                { field: "DoctorID", title: "DoctorID"},
                { field: "DoctorName", title: "Doctor Name" },
                { field: "Degrees", title: "Degrees" },
                { field: "Specialization", title: "Specialization" },
                { field: "Potential", title: "Potential" },
                { field: "Designation", title: "Designation" },
                { field: "RegNo", title: "RegNo" },
                { field: "Phone", title: "Phone" },
                { field: "Email", title: "Email" },
                { field: "Religion", title: "Religion" },
                { field: "Gender", title: "Gender" },
                { field: "Address1", title: "Address1" },
                { field: "Address2", title: "Address2" },
                { field: "Address3", title: "Address3" },
                { field: "Address4", title: "Address4" },
                { field: "MorningLocation", title: "Morning Location" },
                { field: "EveningLocation", title: "Evening Location" },
                { field: "MarketCode", title: "Market Code" },
                { field: "Market", title: "Market" },
                { field: "Region", title: "Region" },
                { field: "ProductGroup", title: "Product Group" },
                { field: "Adoption", title: "Adoption" },
                { field: "TeamTarget", title: "Team Target" },

                {
                    command: [{ name: "DeletedRow", text: "Remove", imageClass: "k-icon k-i-close", click: handleDelete }], title: "Remove", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" }
                },
                {
                    command: [{ name: "EditRow", text: "Edit", imageClass: "k-icon k-i-close", click: handleEdit }], title: "Edit", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" }
                }
            ]
        }).data('kendoGrid');


        function handleDelete(event) {
            event.preventDefault();
            dataitem = MainGrid.dataItem($(event.currentTarget).closest("tr"));
            MainGrid.dataSource.remove(dataitem);
        };

        function handleEdit(event) {
            event.preventDefault();
            dataitem = MainGrid.dataItem($(event.currentTarget).closest("tr"));
            $("#Year").val(dataitem.Year);
            $("#MonthNumber").val(dataitem.MonthNumber);
            $("#Region").val(dataitem.Region);
            $("#MarketName").val(dataitem.MarketName);
            $("#DoctorID").val(dataitem.DoctorID);
            $("#DoctorName").val(dataitem.DoctorName);
            $("#RegNo").val(dataitem.RegNo);
            $("#Phone").val(dataitem.Phone);
            $("#Email").val(dataitem.Email);
            $("#Address").val(dataitem.Address);
            $("#Address1").val(dataitem.Address1);
            $("#Address2").val(dataitem.Address2);
            $("#Address3").val(dataitem.Address3);
            $("#Address4").val(dataitem.Address4);
            $("#MarketCode").val(dataitem.MarketCode);
            $("#Religion").val(dataitem.Religion);
            $("#Designation").val(dataitem.Designation);
            $("#Specialization").val(dataitem.Specialization);
            $("#Potential").val(dataitem.Potential);
            $("#Degrees").val(dataitem.Degrees);
            $("#Gender").val(dataitem.Gender);
            $("#MorningLocation").val(dataitem.MorningLocation);
            $("#EveningLocation").val(dataitem.EveningLocation);
            $("#Market").val(dataitem.Market);
            $("#ProductGroup").val(dataitem.ProductGroup);
            $("#Adoption").val(dataitem.Adoption);
            $("#TeamTarget").val(dataitem.TeamTarget);
        }

        // Filter table row
        $("#txtDoctorId").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                { field: "DoctorID", operator: "contains", value: val },
        

                ]
            });
        });

        $("#txtDoctorName").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                  
                    { field: "DoctorName", operator: "contains", value: val },

                ]
            });
        });
        $("#txtMarketCode").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "MarketCode", operator: "contains", value: val },
                

                ]
            });
        });
        $("#txtMarketName").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "Market", operator: "contains", value: val },
                  

                ]
            });
        });
        $("#txtMorningLocation").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "MorningLocation", operator: "contains", value: val },
                    { field: "EveningLocation", operator: "contains", value: val },
                ]
            });
        });

    var gridInput = 0;
    function GridValidation() {
        gridInput = 0;
        var dataSource = $("#MainGrid").data("kendoGrid").dataSource;
        data = dataSource.data(); // Get Detail Grid Data
        if (data.length > 0) {
            for (var i = data.length - 1; i >= 0; i--) {
                if ((data[i].DoctorID == "") || (data[i].DoctorID == null)) {
                    gridInput = 0;
                }

            }
        }
        else {
            gridInput = 1;
        }
    }




    $('#btnSave').click(function () {
        var model = { };
        GridValidation();
        var Input = InputValidation('MonthNumber') + InputValidation('Year');

        if (Input==0 && gridInput == 0) {
        model.doctorDataUploadInfoList = [];
        var detailDataSource = $('#MainGrid').data("kendoGrid").dataSource;
        var detailData = detailDataSource.data();
        if (detailData.length > 0) {

            for (var i = 0; i < detailData.length; i++) {
                var doctorDetail = {};
                doctorDetail.Year = $("#Year").val();
                doctorDetail.MonthNumber = $("#MonthNumber").val();

                doctorDetail.Region = detailData[i].Region;
                doctorDetail.MarketName = detailData[i].MarketName;

                doctorDetail.DoctorID = detailData[i].DoctorID;
                doctorDetail.DoctorName = detailData[i].DoctorName;
                doctorDetail.RegNo = detailData[i].RegNo;
                doctorDetail.Phone = detailData[i].Phone;
                doctorDetail.Email = detailData[i].Email;
                doctorDetail.Address = detailData[i].Address;
                doctorDetail.Address1 = detailData[i].Address1;
                doctorDetail.Address2 = detailData[i].Address2;
                doctorDetail.Address3 = detailData[i].Address3;
                doctorDetail.Address4 = detailData[i].Address4;
                doctorDetail.Religion = detailData[i].Religion;
                doctorDetail.Designation = detailData[i].Designation;
                doctorDetail.Specialization = detailData[i].Specialization;
                doctorDetail.Potential = detailData[i].Potential;
                doctorDetail.Degrees = detailData[i].Degrees;
                doctorDetail.Gender = detailData[i].Gender;
                doctorDetail.MorningLocation = detailData[i].MorningLocation;
                doctorDetail.EveningLocation = detailData[i].EveningLocation;
                doctorDetail.MarketCode = detailData[i].MarketCode;
                doctorDetail.Market = detailData[i].Market;
                doctorDetail.ProductGroup = detailData[i].ProductGroup;
                doctorDetail.Adoption = detailData[i].Adoption;
                doctorDetail.TeamTarget = detailData[i].TeamTarget;
                model.doctorDataUploadInfoList.push(doctorDetail);

            }
        }

        $.ajax({
            url: '/DoctorDataUpload/OperationsMode',
            data: JSON.stringify(model),
            type: 'POST',
            contentType: 'application/json;',
            dataType: 'json',
            success: function (data) {
                if (data.Status == "Yes") {
                    //$("#FormID").val(data.ID);
                    OperationMsg(data.Mode);
                    toastr.success($("#MessageText").html());
                }
                else {
                    ErrorFrmServerMsg(data.Status);
                    toastr.warning($("#MessageText").html());
                }

            },
            error: function () {
                ErrorFrmClientMsg();
                toastr.warning($("#MessageText").html());
            },
            // complete: function () { CompletedMsg(); },
        }); //End of ajax call
        }
        else {
            ValidationMsg();
            toastr.warning($("#MessageText").html());
        }
    });

        $('#btnSaveSingle').click(function () {
            var model = {};
            //GridValidation();
            var Input = InputValidation('MonthNumber') + InputValidation('Year');

            if (Input == 0) {
                model.doctorDataUploadInfoList = [];

                var doctorDetail = {};
                doctorDetail.Year = $("#Year").val();
                doctorDetail.MonthNumber = $("#MonthNumber").val();

                doctorDetail.Region = $("#Region").val();
                doctorDetail.MarketName = $("#MarketName").val();
                doctorDetail.DoctorID = $("#DoctorID").val();
                doctorDetail.DoctorName = $("#DoctorName").val();
                doctorDetail.RegNo = $("#RegNo").val();
                doctorDetail.Phone = $("#Phone").val();
                doctorDetail.Email = $("#Email").val();
                doctorDetail.Address = $("#Address").val();
                doctorDetail.Address1 = $("#Address1").val();
                doctorDetail.Address2 = $("#Address2").val();
                doctorDetail.Address3 = $("#Address3").val();
                doctorDetail.Address4 = $("#Address4").val();
                doctorDetail.MarketCode = $("#MarketCode").val();

                doctorDetail.Market = markets.find(e => e.MarketCode == doctorDetail.MarketCode)?.Market;

                doctorDetail.Religion = $("#Religion").val();
                doctorDetail.Designation = $("#Designation").val();
                doctorDetail.Specialization = $("#Specialization").val();
                doctorDetail.Potential = $("#Potential").val();
                doctorDetail.Degrees = $("#Degrees").val();
                doctorDetail.Gender = $("#Gender").val();
                doctorDetail.MorningLocation = $("#MorningLocation").val();
                doctorDetail.EveningLocation = $("#EveningLocation").val();
                doctorDetail.Market = $("#Market").val();
                doctorDetail.ProductGroup = $("#ProductGroup").val();
                doctorDetail.Adoption = $("#Adoption").val();
                doctorDetail.TeamTarget = $("#TeamTarget").val();

                if (doctorDetail.DoctorID == null || doctorDetail.DoctorID == "") {
                    ValidationMsg("Doctor ID is Required!");
                    toastr.error($("#MessageText").html());
                    return
                }
                if (doctorDetail.DoctorName == null || doctorDetail.DoctorName == "") {
                    ValidationMsg("Doctor Name is Required!");
                    toastr.error($("#MessageText").html());
                    return
                }
                if (doctorDetail.MarketCode == null || doctorDetail.MarketCode == "") {
                    ValidationMsg("Market is Required!");
                    toastr.error($("#MessageText").html());
                    return
                }
                const emailRegex = RegExp(/^\S+@@\S+\.\S+$/)
                if (doctorDetail.Phone != null && doctorDetail.Phone != "") {
                    if (!doctorDetail.Phone.match(/^\+?[0-9]\d{1,20}$/)) {
                        ValidationMsg("Provide a valid Phone number!");
                        toastr.error($("#MessageText").html());
                        return
                    }
                }
                if (doctorDetail.Email != null && doctorDetail.Email != "") {
                    if (!doctorDetail.Email.match(emailRegex)) {
                        ValidationMsg("Provide a valid Email!");
                        toastr.error($("#MessageText").html());
                        return
                    }
                }
                model.doctorDataUploadInfoList.push(doctorDetail);


                $.ajax({
                    url: '/DoctorDataUpload/OperationsMode',
                    data: JSON.stringify(model),
                    type: 'POST',
                    contentType: 'application/json;',
                    dataType: 'json',
                    success: function (data) {
                        if (data.Status == "Yes") {
                            //$("#FormID").val(data.ID);
                            OperationMsg(data.Mode);
                            toastr.success($("#MessageText").html());
                        }
                        else {
                            ErrorFrmServerMsg(data.Status);
                            toastr.warning($("#MessageText").html());
                        }

                    },
                    error: function () {
                        ErrorFrmClientMsg();
                        toastr.warning($("#MessageText").html());
                    },
                    // complete: function () { CompletedMsg(); },
                }); //End of ajax call
            }
            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }
        });
    });

</script>
