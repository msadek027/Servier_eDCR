@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<link href="~/Content/CustomCSS/exportPDF.css" rel="stylesheet" />
<script src="~/Scripts/CustomJS/DefaultValue.js"></script>




<style>
    .red {
        background-color: red;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {



        var DetailSL = "";
        var DayNumber = "";
        var AnDetailSL = "";
        var CalenderCell = "";
        var SetTime = "";
        var ShiftType = "";
        var ShiftName = "";
        var DetailStatus = "";
        var Allowence = "";


        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });

        EventPermission();   


        $(".datepicker").datepicker({
            format: " yyyy",
            viewMode: "years",
            minViewMode: "years",
            autoclose: true
        });
        $("#Year").val(yyyy);
        LoadMonth();
        GetEmpForSup();

        function LoadMonth() {
            $.ajax({
                url: '/Default/GetGenMonth',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#MonthNumber').append($('<option>', { value: item.MonthNumber, html: item.MonthName }, '<option/>'));
                    });
                },
                error: function () {
                    alert("Failed to load ... !!");
                }
            });
        }

        function GetEmpForSup() {
            $.ajax({
                url: '/Default/GetEmpForSup',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#LocCode').append($('<option>', { value: item.LocCode, html: item.EmployeeName }, '<option/>'));
                        $('#LocName').val(item.EmployeeName);
                    });
                },
                error: function () {
                    alert("Failed to load ... !!");
                }
            });
        }
        $('#LocCode').on('change', function () {
            $('#LocName').val($("#LocCode option:selected").text());
        }).trigger('change');;


        $('#btnReview').click(function () {


            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);



            var model = {};
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            var Input = InputValidation('MonthNumber') + InputValidation('Year');
            if (Input == 0) {
                ReviewWindow.center();
                ReviewWindow.open();
                $.ajax({

                    type: "POST",
                    url: '/TourPlanTmRsm/GetPopupReview',
                    data: JSON.stringify({ model: model }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data != "") {
                            $('#ReviewWindowGrid').data('kendoGrid').dataSource.data(data);

                        }
                        else {
                            ReviewWindow.close();
                            AcknowledgeMsg();
                            toastr.info($("#MessageText").html());
                        }

                    },
                    error: function () {
                        alert('Error occured!');
                    },
                    //complete: function () { },
                });
            }
            else {
                ValidationMsg();
                toastr.info($("#MessageText").html());
            }
        });

        $('#IsActive').click(function () {
            if ($(this).is(':checked')) {
                $(this).siblings('label').html('Unhide');
                $('#divValueParameter').hide();
            }
            else {
                $(this).siblings('label').html('Hide');
                $('#divValueParameter').show();
            }
        });
        $('#btnView').click(function () {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);
            $("#ViewReview").val("View");
            var model = {};

            var Input = InputValidation('MonthNumber') + InputValidation('Year') + InputValidation('LocCode');
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();

            model.LocCode = $("#LocCode").val();
            model.ViewReview = $("#ViewReview").val();

            if (Input == 0) {
                $.ajax({
                    type: "POST",
                    url: "/TourPlanTmRsm/GetViewData",
                    data: JSON.stringify({ model: model }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.length > 0) {
                            $("#MainGrid").data("kendoGrid").dataSource.data(data);


                        }
                        else {
                            AcknowledgeMsg();
                            toastr.info($("#MessageText").html());

                        }
                        //$("#divLoading").hide();
                    },
                });
            }
            else {
                ValidationMsg();
                toastr.info($("#MessageText").html());
            }
        });


        $('#btnStatus').click(function () {

            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

            var model = {};
            model.Year = $("#Year").val();

            model.MonthNumber = $("#MonthNumber").val();
            var Input = InputValidation('MonthNumber') + InputValidation('Year');
            if (Input == 0) {

                PopupWindow.center();
                PopupWindow.open();
                $.ajax({
                    url: '/TourPlanTmRsm/GetPopupView',
                    type: "POST",
                    data: JSON.stringify({ model: model }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data != "") {
                            $('#PopupWindowGrid').data('kendoGrid').dataSource.data(data);
                        }
                        else {
                            PopupWindow.close();
                            AcknowledgeMsg();
                            toastr.info($("#MessageText").html());
                        }

                    },
                    error: function () {
                        alert('Error occured!');
                    },
                    //complete: function () { },
                });
            }
            else {
                ValidationMsg();
                toastr.info($("#MessageText").html());
            }
        });

        var ReviewWindow = $("#ReviewWindow").kendoWindow({
            //width: "60%",
            //height: "50%",
            draggable: true,
            modal: true,
            resizable: false,
            title: "LOV."
        }).data("kendoWindow");

        //Initializing Main page details Kendo Grid Colums
        var ReviewGrid = $('#ReviewWindowGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "EmpCode",
                        fields: {
                            MasterSL: { type: "string" },
                            EmpCode: { type: "string" },
                            EmployeeName: { type: "string" },
                            Designation: { type: "string" },
                            LocCode: { type: "string" },
                            MonthNumber: { type: "string" },
                            MonthName: { type: "string" },
                            Year: { type: "string" },
                            MasterStatus: { type: "string" },
                            VW: { type: "string" }

                        }
                    }
                },
                pageSize: 10,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);

            },
            scrollable: false,
            sortable: false,
            filterable: false,
            editable: false,
            selectable: "row",
            //selectable: "multiple",
            toolbar: [{ template: "<input type='text' id='txtPopupInput'  style='float:right' placeholder='Search...' class='k-textbox'>" },],
            navigatable: true,

            columnMenu: false,
            reorderable: false,
            resizable: false,
            resize: function (e) {
                this.table.height(this.element.height() + this.table.height() - 1);
            },
            columns: [
                { field: "MasterSL", hidden: true, title: "Master SL" },
                { field: "EmpCode", title: "Emp Code", hidden: true },
                { field: "EmployeeName", title: "Emp Name" },
                { field: "Designation", title: "Designation" },
                { field: "LocCode", title: "Loc Code" },
                { field: "MonthNumber", title: "Month Number", hidden: true },
                { field: "MonthName", title: "Month" },
                { field: "Year", title: "Year" },
                { field: "MasterStatus", title: "Status", hidden: true },
                { field: "VW", title: "VW", hidden: true },
            ]

        }).data('kendoGrid');

        $("#ReviewWindowGrid").click(function () {

            var gridData = $("#ReviewWindowGrid").data("kendoGrid");
            var selectedItem = (gridData.dataItem(gridData.select())); //Selected Row

            var LocCode = selectedItem.LocCode;

            //$("#EmpCode").val(selectedItem.EmpCode);
            //$("#EmployeeName").val(selectedItem.EmployeeName);
            $("#LocCode").val(selectedItem.LocCode);
            //$("#Designation").val(selectedItem.Designation);
            $("#Year").val(selectedItem.Year);
            $("#MonthNumber").val(selectedItem.MonthNumber);
            $("#ViewReview").val("Review");
            var MasterSL = selectedItem.MasterSL;
            var MasterStatus = selectedItem.MasterStatus;
            VW = selectedItem.VW;
            ReviewWindow.close();


            GetDataReview(selectedItem);


        });




        //Initializing Main page details Kendo Grid Colums
        var PopupGrid = $('#PopupWindowGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "EmpCode",
                        fields: {
                            MasterSL: { type: "string" },
                            EmpCode: { type: "string" },
                            EmployeeName: { type: "string" },
                            Designation: { type: "string" },
                            LocCode: { type: "string" },
                            MonthNumber: { type: "string" },
                            MonthName: { type: "string" },
                            Year: { type: "string" },
                            MasterStatus: { type: "string" }
                        }
                    }
                },
                // pageSize: 10,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);

            },
            scrollable: false,
            sortable: false,
            filterable: false,
            editable: false,
            selectable: "row",
            //selectable: "multiple",
            toolbar: [{ template: "<input type='text' id='txtPopupInput'  style='float:right' placeholder='Search...' class='k-textbox'>" },],
            navigatable: true,

            columnMenu: false,
            reorderable: false,
            resizable: false,
            resize: function (e) {
                this.table.height(this.element.height() + this.table.height() - 1);
            },
            columns: [
                { field: "MasterSL", hidden: true, title: "Master SL" },
                { field: "EmpCode", title: "Emp Code", hidden: true },
                { field: "EmployeeName", title: "Emp Name" },
                { field: "Designation", title: "Designation" },
                { field: "LocCode", title: "Loc Code" },
                { field: "MonthNumber", title: "Month Number", hidden: true },
                { field: "MonthName", title: "Month" },
                { field: "Year", title: "Year" },
                { field: "MasterStatus", title: "Status", }

            ]

        }).data('kendoGrid');



        $("#PopupWindowGrid").click(function () {

            var gridData = $("#PopupWindowGrid").data("kendoGrid");
            var selectedItem = (gridData.dataItem(gridData.select())); //Selected Row

            var LocCode = selectedItem.LocCode;
            //$("#EmpCode").val(selectedItem.EmpCode);
            //$("#EmployeeName").val(selectedItem.EmployeeName);
            //$("#Designation").val(selectedItem.Designation);
            $("#LocCode").val(selectedItem.LocCode);
            $("#Year").val(selectedItem.Year);
            $("#MonthNumber").val(selectedItem.MonthNumber);
            $("#ViewReview").val("View");

            var MasterSL = selectedItem.MasterSL;
            var MasterStatus = selectedItem.MasterStatus;
            PopupWindow.close();

            var model = {};
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            //model.Designation = $("#Designation").val();
            model.LocCode = $("#LocCode").val();
            //model.EmpCode = $("#EmpCode").val();
            //model.EmployeeName = $("#EmployeeName").val();

            GetDataView(model);

        });













        function GetDataReview(data) {
            $.ajax({
                type: "POST",
                url: "/TourPlanTmRsm/GetReviewData",
                data: JSON.stringify({ model: data }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data.length > 0) {
                        $("#MainGrid").data("kendoGrid").dataSource.data(data);

                        $("#btnExcel").attr("disabled", false);
                        $("#btnPDF").attr("disabled", false);
                    }
                },
            });

        }

        function GetDataView(model) {
            $("#divLoading").show();
            $.ajax({
                type: "POST",
                url: "/TourPlanTmRsm/GetViewData",
                data: JSON.stringify({ model: model }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data.length > 0) {
                        $("#MainGrid").data("kendoGrid").dataSource.data(data);
                    }
                    $("#divLoading").hide();
                },

            });

        }


        var gridInput = 0;
        function GridValidation() {
            gridInput = 0;
            var dataSource = $("#MainGrid").data("kendoGrid").dataSource;
            data = dataSource.data(); // Get Detail Grid Data
            if (dataSource.view().length <= 0) {
                gridInput = 1;
            }
        }



        $('#btnSave').click(function () {

            GridValidation();
            var Input = InputValidation('MonthNumber') + InputValidation('Year') + InputValidation('LocCode');

            model = {};
            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();

            model.LocCode = $("#LocCode").val();


            model.ViewReview = $("#ViewReview").val();

            if (Input == 0 && gridInput == 0) {


                $.ajax({
                    url: '/TourPlanTmRsm/OperationsMode',
                    data: JSON.stringify(model),
                    type: 'POST',
                    contentType: 'application/json;',
                    dataType: 'json',
                    success: function (data) {
                        if (data.Status == "Yes") {
                            OperationMsg(data.Mode);
                            toastr.success($("#MessageText").html());
                            //  PushNotification(model);

                        }
                        else {
                            ErrorFrmServerMsg(data.Status);
                            toastr.warning($("#MessageText").html());
                        }

                    },
                    error: function () {
                        ErrorFrmClientMsg();
                        toastr.warning($("#MessageText").html());
                    },
                    // complete: function () { CompletedMsg(); },
                }); //End of ajax call

            }

            else {
                ValidationMsg();
                toastr.info($("#MessageText").html());
            }

        });

        function PushNotification() {
            $.ajax({
                url: '/TourPlanTmRsm/PushNotification',
                data: JSON.stringify(model),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                },
                async: false,

                // complete: function () { CompletedMsg(); },
            }); //End of ajax call
        }

        $("#MainGrid").kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "DayNumber",
                        fields: {
                            DayNumber: { type: "string" },


                            MInstName: { type: "string" },
                            MMeetingPlace: { type: "string" },
                            MSetTime: { type: "string" },
                            MAccompany: { type: "string" },
                            MAllowence: { type: "string" },
                            EReview: { type: "string" },

                            EInstName: { type: "string" },
                            EMeetingPlace: { type: "string" },
                            ESetTime: { type: "string" },
                            EAccompany: { type: "string" },
                            EAllowence: { type: "string" },
                            EReview: { type: "string" },
                        }
                    }
                },
                //  pageSize: 10,
            }),
            pageable: {
                pageSizes: true, buttonCount: 5
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);
                onDataBoundColor(e)
            },
            toolbar: [{ template: "<input type='text' id='txtReport'  style='float:right' placeholder='Search...' class='k-textbox'>" },],

            scrollable: true,
            sortable: true,
            filterable: false,
            editable: false,
            navigatable: false,
            columnMenu: false,
            reorderable: false,
            resizable: true,
            resize: function (e) {
                this.table.height(this.element.height() + this.table.height() - 1);
            },


            columns: [
                // { field: "DayNumber", title: "Day", width: 150, template: "<a href='javascript:void(0)' style='text-decoration: underline;' class='a:link btnLinkDayNumber'> ${DayNumber} </a>" },
                { field: "DayNumber", title: "Day", width: 150 },
                {
                    title: "MORNING", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" },
                    columns: [

                        { field: "MInstName", title: "Location", width: 150 },
                        { field: "MMeetingPlace", title: "Address", width: 150 },
                        { field: "MSetTime", title: "R.Time", width: 70 },
                        { field: "MAccompany", title: "Accompany", width: 100 },
                        { field: "MAllowence", title: "NDA", width: 70 },
                        { field: "EReview", title: "Review", width: 50, hidden: true },

                    ]
                },
                {
                    title: "EVENING", headerAttributes: { "class": "gridHeader", style: "font-weight: bold;font-size: 13px;text-align: center;" },
                    columns: [
                        { field: "EInstName", title: "Location", width: 150 },
                        { field: "EMeetingPlace", title: "Address", width: 150 },
                        { field: "ESetTime", title: "R.Time", width: 70 },
                        { field: "EAccompany", title: "Accompany", width: 100 },
                        { field: "EAllowence", title: "NDA", width: 70 },
                        { field: "EReview", title: "Review", width: 50, hidden: true },

                    ]
                },

            ],
        });

        function onDataBoundColor(e) {
            var grid = $("#MainGrid").data("kendoGrid");
            var gridData = grid.dataSource.view();
            for (var i = 0; i < gridData.length; i++) {
                var currentUid = gridData[i].uid;
                if (gridData[i].MReview == "Approved") {
                    var currentRow = grid.table.find("tr[data-uid='" + currentUid + "']");
                    currentRow.css('background-color', 'DARKCYAN');

                    //var currentRow = grid.table.find("tr[data-uid='" + currentUid + "'] td:nth-child(0)");
                    //currentRow.css('background-color', 'green');

                    // $('tr[data-uid="' + row.uid + '"] td:nth-child(5)').css("background-color", "red");
                }
            }
        }

        var EditPopupWindow = $("#EditPopupWindow").kendoWindow({
            width: "50%",
            draggable: true,
            modal: true,
            resizable: true,
            title: "List",
        }).data("kendoWindow");





        function LoadAllowanceNature() {
            $.ajax({
                url: '/TourPlanNew/GetAllowanceNature',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $('#mAllowanceNature').empty();
                    $('#eAllowanceNature').empty();
                    $.each(data, function (i, item) {
                        $('#mAllowanceNature').append($('<option>', { value: item.Allowence, html: item.Allowence }, '<option/>'));
                        $('#eAllowanceNature').append($('<option>', { value: item.Allowence, html: item.Allowence }, '<option/>'));
                    });
                },

            });
        }
        $("#mInstCode").multiselect({ enableFiltering: false, maxHeight: 80 }).trigger('reset');
        function LoadMorningInst(model) {
            $.ajax({
                url: '/TourPlanTmRsm/MorningInst',
                data: JSON.stringify({ model: model }),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    $('#mInstCode').multiselect('deselectAll', false);
                    $('#mInstCode').multiselect('updateButtonText');
                    $('#mInstCode').empty();
                    $('#mInstCode').multiselect('refresh');
                    $.each(data, function (i, item) {
                        if (item.YetAssigned == "true") {
                            $('#mInstCode').append($('<option>', { value: item.MInstCode, html: item.MInstName }, '<option/>')).multiselect('rebuild');
                            $('#mInstCode').multiselect('selectAll', false);
                            $('#mInstCode').multiselect('updateButtonText');
                        }
                        //else {
                        //    $('#mInstCode').append($('<option>', { value: item.MInstCode, html: item.MInstName }, '<option/>')).multiselect('rebuild');
                        //    $('#mInstCode').multiselect('selectAll', true);
                        //    $('#mInstCode').multiselect('updateButtonText');
                        //}


                    });
                },

            });
        }
        $("#eInstCode").multiselect({ enableFiltering: false, maxHeight: 80 }).trigger('reset');
        function LoadEveningInst(model) {
            $.ajax({
                url: '/TourPlanTmRsm/EveningInst',
                data: JSON.stringify({ model: model }),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    $('#eInstCode').multiselect('deselectAll', false);
                    $('#eInstCode').multiselect('updateButtonText');
                    $('#eInstCode').empty();
                    $('#eInstCode').multiselect('refresh');
                    $.each(data, function (i, item) {
                        if (item.YetAssigned == "true") {
                            $('#eInstCode').append($('<option>', { value: item.EInstCode, html: item.EInstName }, '<option/>')).multiselect('rebuild');
                            $('#eInstCode').multiselect('selectAll', false);
                            $('#eInstCode').multiselect('updateButtonText');
                        }
                        //else {
                        //    $('#eInstCode').append($('<option>', { value: item.EInstCode, html: item.EInstName }, '<option/>')).multiselect('rebuild');
                        //    $('#eInstCode').multiselect('selectAll', true);
                        //    $('#eInstCode').multiselect('updateButtonText');
                        //}
                    });
                },

            });
        }
        function eInstEmpty() {
            $('#eInstCode').multiselect('deselectAll', false);
            $('#eInstCode').multiselect('updateButtonText');
            $('#eInstCode').empty();
            $('#eInstCode').multiselect('refresh');
            $('#eInstCode').append($('<option>', { value: "", html: "" }, '<option/>')).multiselect('rebuild');
        }

        function mInstEmpty() {
            $('#mInstCode').multiselect('deselectAll', false);
            $('#mInstCode').multiselect('updateButtonText');
            $('#mInstCode').empty();
            $('#mInstCode').multiselect('refresh');
            $('#mInstCode').append($('<option>', { value: "", html: "" }, '<option/>')).multiselect('rebuild');
        }

        $("#MainGrid").on("click", ".btnLinkDayNumber", function (e) {


            var grid = $("#MainGrid").data("kendoGrid");
            var dataItem = grid.dataItem($(e.currentTarget).closest("tr"));

            var model = {};
            model.Year = $("#Year").val();

            model.MonthNumber = $("#MonthNumber").val();

            model.LocCode = $("#LocCode").val();
            //model.EmpCode = $("#EmpCode").val();
            //model.Designation = $("#Designation").val();
            model.DayNumber = dataItem.DayNumber;
            $("#DayNumber").val(dataItem.DayNumber);

            LoadMorningInst(model);
            LoadEveningInst(model);
            LoadAllowanceNature();
            EditPopupWindow.center();
            EditPopupWindow.open();


            var mSelectNDA = dataItem.MAllowence;
            var eSelectNDA = dataItem.EAllowence;



            $.ajax({
                type: "POST",
                url: "/TourPlanTmRsm/DetailValueTmRsm",
                data: JSON.stringify({ model: model }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $("#mtShiftType").val(item.MShiftType);
                        $("#etShiftType").val(item.EShiftType);

                        $("#mShiftType").val(item.MShiftType);
                        $("#eShiftType").val(item.EShiftType);


                        $("#mAllowanceNature").val(item.MAllowence);
                        $("#eAllowanceNature").val(item.EAllowence);

                    });

                    //$("#mAllowanceNature").val(mSelectNDA);
                    //$("#eAllowanceNature").val(eSelectNDA);


                },
                error: function () {
                    alert('Error occured!');
                },
            });





        });

        $('#mShiftType').change(function () {
            var ShiftType = $("#mtShiftType").val();



            if (ShiftType == "Working") {
                $("#mShiftType").val($(this).val());

            }
            else {
                $("#mShiftType").val(ShiftType);
            }
        });

        $('#eShiftType').change(function () {
            var ShiftType = $("#etShiftType").val();

            if (ShiftType == "Working") {
                $("#eShiftType").val($(this).val());
            }
            else {
                $("#eShiftType").val(ShiftType);
            }

        });
        $('#btnEdit').click(function () {
            var model = {};

            var model = {};
            model.Year = $("#Year").val();

            model.MonthNumber = $("#MonthNumber").val();
            model.MPGroup = $("#MPGroup").val();
            model.TerritoryManagerID = $("#TerritoryManagerID").val();
            model.DayNumber = $("#DayNumber").val();

            model.MShiftType = $("#mShiftType").val();
            model.EShiftType = $("#eShiftType").val();

            model.MAllowence = $("#mAllowanceNature").val();
            model.EAllowence = $("#eAllowanceNature").val();

            var mInst = $('#mInstCode').val();
            model.MInstCode = JSON.stringify(mInst);
            var eInst = $('#eInstCode').val();
            model.EInstCode = JSON.stringify(eInst);


            $.ajax({
                url: '/TourPlanTmRsm/OperationsModeEdit',
                data: JSON.stringify(model),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    if (data.Status == "Yes") {
                        OperationMsg(data.Mode);
                        toastr.success($("#MessageText").html());
                        ReloadData();

                    }
                    else if (data.Status == "No") {
                        OperationMsg(data.Mode);
                        toastr.info($("#MessageText").html());
                    }
                    else {
                        ErrorFrmServerMsg(data.Status);
                        toastr.warning($("#MessageText").html());
                    }

                },
                error: function () {
                    ErrorFrmClientMsg();
                    toastr.warning($("#MessageText").html());
                },

            });
        });










    });

</script>
<script language="javascript" type="text/javascript">

    function InputValidationPdfExcel() {
        var Input = InputValidation('MonthNumber') + InputValidation('Year') + InputValidation('LocCode');


        if (Input == 0) {
            return true;
        }
        else
            return false;
    }

</script>





<div class="box-header with-border">
    <form class="form" action="/TourPlanTmRsm/Export" id="R1Form" method="post" name="H1Form" target="_blank">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2"><div id="MessageText"></div></div>
            <div class="col-xs-0 col-sm-0 col-md-10 col-lg-10">
                <div style="text-align:right;">
                    <input type="checkbox" id="IsActive" class="chk" name="IsActive"> <label for="IsActive"> Hide</label>
                    <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-file"></i> View</button>
                    <button id="btnStatus" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-check"></i> Status</button>
                    <button id="btnReview" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-retweet"></i> ChangeTP</button>
                    <button id="btnSave" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-ok"></i> Approve</button>
                    <button type="submit" id="btnExcel" name="ExportType" value="Excel" class="btn btn-primary btn-sm" onclick="return InputValidationPdfExcel();" formaction="/TourPlanTmRsm/Export" data-toggle="tooltip" data-placement="right" title="[Mandatory: Month, Year, Region,TM,MPO]"><i class="glyphicon glyphicon-envelope"></i> Excel </button>
                    <button type="submit" id="btnPDF" name="ExportType" value="PDF" class="btn btn-primary btn-sm" onclick="return InputValidationPdfExcel();" formaction="/TourPlanTmRsm/Export" data-toggle="tooltip" data-placement="right" title="[Mandatory: Month, Year, Region,TM,MPO]"><i class="glyphicon glyphicon-book"></i> Pdf </button>

                </div>
            </div>
        </div>



        <div class="box-body">

            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Month - Year:</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <div class="input-group">
                    <select id="MonthNumber" name="MonthNumber" class=" RequiredField form-control"></select>
                    <span class="input-group-btn" style="width:2px;"></span>
                    <input type="text" id="Year" name="Year" class="datepicker RequiredField form-control" />
                </div>
            </div>



            <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">

                <span style="background-color:lightskyblue;display:none" id="MasterStatus"></span>
                <input type="hidden" id="ViewReview" name="ViewReview" class="form-control RequiredField" readonly="readonly">
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Employee:</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <select id="LocCode" name="LocCode" class="RequiredField form-control"></select>
                <input type="hidden" id="LocName" name="LocName" class="RequiredField form-control">
            </div>

            <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">

            </div>
        </div>



    </form>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div id="MainGrid" class="MainGrid"></div>
    </div>
</div>






<div class="row">
    <div id="PopupWindow" class="PopupWindowLayout" style="display: none;">
        <div id="PopupWindowGrid" class="PopUpGrid"></div>
    </div>
</div>


<div class="row">
    <div id="ReviewWindow" class="ReviewWindowLayout" style="display: none;">
        <div id="ReviewWindowGrid" class="PopUpGrid"></div>
    </div>
</div>






<div class="row">
    <div id="EditPopupWindow" class="PopupWindowLayout" style="display: none;">
        <div class="input-group">
            <div id="Parameter"></div><span class="input-group-btn" style="width:20px;"></span><div style="background-color:lightskyblue" id="Parameter2"></div>
        </div>

        <div class="input-group">
            <span class="input-group-addon">DayNumber:</span>
            <span class="input-group-addon"><input type="text" id="DayNumber" name="DayNumber" class="form-control RequiredField" readonly></span>
            <span class="input-group-addon"><button id="btnEdit" class="btn btn-primary btn-lg" type="button"><i class="glyphicon glyphicon-save-file"></i>Save</button></span>
        </div>
        <fieldset>
            <legend>Morning:</legend>
            <div class="input-group">
                <span class="input-group-addon"></span>
                <input type="hidden" id="mtShiftType">
                <span class="input-group-addon"></span>
                <select id="mShiftType" name="mShiftType" class="RequiredField input-sm">
                    <option value="Working">Working</option>
                    <option value="Leave">Leave</option>
                    <option value="Meeting">Meeting</option>
                </select>
                <span class="input-group-addon">NDA:</span>
                <select id="mAllowanceNature" name="mAllowanceNature" class="RequiredField input-sm"></select>
                <span class="input-group-addon">Location :</span>
                <select id="mInstCode" name="mInstCode" class="RequiredField input-sm" multiple="multiple"></select>
            </div>
        </fieldset>
        <fieldset>
            <legend>Evening:</legend>
            <div class="input-group">
                <span class="input-group-addon"></span>
                <input type="hidden" id="etShiftType">
                <span class="input-group-addon"></span>
                <select id="eShiftType" name="eShiftType" class="RequiredField input-sm">
                    <option value="Working">Working</option>
                    <option value="Leave">Leave</option>
                    <option value="Meeting">Meeting</option>
                </select>
                <span class="input-group-addon">NDA:</span>
                <select id="eAllowanceNature" name="eAllowanceNature" class="RequiredField input-sm"></select>
                <span class="input-group-addon">Location :</span>
                <select id="eInstCode" name="eInstCode" class="RequiredField input-sm" multiple="multiple"></select>


            </div>
        </fieldset>
        <br />
        <br />
        <br />
        <br />
        <br />

    </div>


</div>

<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p style="position: absolute; top: 50%; left: 50%; color: White;">
        <img src="~/Content/Images/loading.gif" />
    </p>
</div>
