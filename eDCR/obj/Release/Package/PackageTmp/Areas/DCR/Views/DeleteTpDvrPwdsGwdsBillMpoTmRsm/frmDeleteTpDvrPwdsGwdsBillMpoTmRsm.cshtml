@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<link href="~/Content/CustomCSS/exportPDF.css" rel="stylesheet" />
<script src="~/Scripts/CustomJS/DefaultValue.js"></script>




<script>





    $(document).ready(function () {
        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });

     //   EventPermission();
        $("#btnWaiting").attr("disabled", true);
        $("#btnApprove").attr("disabled", true);
      //  $("#btnDelete").attr("disabled", true);

        $(".datepicker").datepicker({
            format: " yyyy",
            viewMode: "years",
            minViewMode: "years",
            autoclose: true
        });

        $('#IsActive').click(function () {
            if ($(this).is(':checked')) {
                $(this).siblings('label').html('Unhide');
                $('#divValueParameter').hide();
            }
            else {
                $(this).siblings('label').html('Hide');
                $('#divValueParameter').show();
            }
        });
        $("#Year").val(yyyy);
        LoadMonth();
        //  GetEmpForSup();
        function LoadMonth() {
            $.ajax({
                url: '/Default/GetGenMonth',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#MonthNumber').append($('<option>', { value: item.MonthNumber, html: item.MonthName }, '<option/>'));
                    });
                },
                error: function () {
                    alert("Failed to load !!");
                }
            });
        }
        $('#MonthNumber').on('change', function () {           

            var date = new Date(), y = date.getFullYear(), m = date.getMonth() + 1;
            var mm = m.toString.length == 1 ? "0" + m.toString() : m.toString();
            var ymCnt = y.toString() + mm;
            var ymInput = $("#Year").val().toString() + $('#MonthNumber').val().toString();

            if (parseFloat(ymCnt) <= parseFloat(ymInput)) {
                $("#btnDelete").attr("disabled", false);
            }
            else {
                $("#btnDelete").attr("disabled", true);
            }
        });
        $('#Year').on('change', function () {
            $('#MonthNumber').val('');
        });

        function DeleteButtonEnableDisable()
        {
        }
        $('#OperationMode').on('change', function () {
           
            $("#DayNumber").val('');
            if ($(this).val() == "BILL" || $(this).val() == "TmRsmBILL") {
                $("#DayNumber").attr("disabled", false);
            }
            else {
                $("#DayNumber").attr("disabled", true);
            }
            $('#Designation').val('');
            $('#LocCode').empty();
          
        }).trigger('change');

        $('#Designation').on('change', function () {
            var opVal = $('#OperationMode').val();
            if ((opVal == "TP" || opVal == "DVR" || opVal == "PWDS" || opVal == "GWDS" || opVal == "BILL") && $(this).val()=="MPO")
            {
                GetEmpForSup($(this).val(), $('#OperationMode').val());
            }
            else if ((opVal == "TmRsmTP" || opVal == "TmRsmBILL") && $(this).val() != "MPO") {
                GetEmpForSup($(this).val(), $('#OperationMode').val());
            }
            else {
                $('#Designation').val('');
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }
           
        }).trigger('change');

        $('#LocCode').select2();
        function GetEmpForSup(Designation, OperationMode) {

            if (Designation != "") {

                $.ajax({
                    type: "POST",
                    url: '/Default/GetEmpForDesignation',
                    data: JSON.stringify({ Designation: Designation, OperationMode: OperationMode }),
                    dataType: 'json',
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        $('#LocCode').empty();
                        $.each(data, function (i, item) {

                            if (i == 0) {
                                if (data.length > 1) {
                                    $('#LocCode').append('<option value="" selected="selected"></option>');
                                }
                            }

                            $('#LocCode').append($('<option>', { value: item.LocCode, html: item.EmployeeName }, '<option/>'));
                            $('#LocName').val(item.EmployeeName);

                        });

                    },
                    error: function () {
                        alert("Failed to load... !!");
                    }
                });
            }
            else {
                $('#LocCode').append('<option value="" selected="selected"></option>');
            }
        }


        $('#LocCode').on('change', function () {
            $('#LocName').val($("#LocCode option:selected").text());
        }).trigger('change');
        $('#IsActive').click(function () {
            if ($(this).is(':checked')) {
                $(this).siblings('label').html('Unhide');
                $('#divValueParameter').hide();
            }
            else {
                $(this).siblings('label').html('Hide');
                $('#divValueParameter').show();
            }
        });








        $('#btnDelete').click(function () {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');

            var model = {};



            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.DayNumber = $("#DayNumber").val();

            model.OperationMode = $("#OperationMode").val();
            model.Designation = $("#Designation").val();
            model.LocCode = $("#LocCode").val();
            var Input = InputValidation('MonthNumber') + InputValidation('Year') + InputValidation('Designation') + InputValidation('OperationMode') + InputValidation('LocCode');
            if (Input == 0) {


                if ((model.Designation == "TM" || model.Designation == "RSM") && (model.OperationMode == "DVR" || model.OperationMode == "PWDS" || model.OperationMode == "GWDS")) {

                    ValidationMsg();
                    toastr.warning($("#MessageText").html());
                }
                else {
                    $.ajax({
                        url: '/DeleteTpDvrPwdsGwdsBillMpoTmRsm/OperationsMode',
                        data: JSON.stringify(model),
                        type: 'POST',
                        contentType: 'application/json;',
                        dataType: 'json',
                        success: function (data) {
                            if (data.Status == "Yes") {
                                toastr.success(data.Mode);
                            }
                            else {
                                ErrorFrmServerMsg(data.Status);
                                toastr.warning($("#MessageText").html());
                            }

                        },
                        error: function () {
                            ErrorFrmClientMsg();
                            toastr.warning($("#MessageText").html());
                        },
                        // complete: function () { CompletedMsg(); },
                    }); //End of ajax call
                }
            }
            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }

        });


        $('#btnApprove').click(function () {
            ApproveWatingStatus("Approved");

        });
        $('#btnWaiting').click(function () {
            ApproveWatingStatus("Waiting");
        });

        function ApproveWatingStatus(Status) {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
            var model = {};

            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.DayNumber = $("#DayNumber").val();

            model.OperationMode = $("#OperationMode").val();
            model.Designation = $("#Designation").val();
            model.LocCode = $("#LocCode").val();
            model.Status = Status;
            var Input = InputValidation('MonthNumber') + InputValidation('Year') + InputValidation('Designation') + InputValidation('OperationMode') + InputValidation('LocCode');
            if (Input == 0) {

                if ((model.Designation == "TM" || model.Designation == "RSM") && (model.OperationMode == "DVR" || model.OperationMode == "PWDS" || model.OperationMode == "GWDS")) {

                    ValidationMsg();
                    toastr.warning($("#MessageText").html());
                }
                else {
                    $.ajax({
                        url: '/DeleteTpDvrPwdsGwdsBillMpoTmRsm/OperationsModeApproveWaiting',
                        data: JSON.stringify(model),
                        type: 'POST',
                        contentType: 'application/json;',
                        dataType: 'json',
                        success: function (data) {
                            if (data.Status == "Yes") {
                                toastr.success(data.Mode);
                            }
                            else {
                                ErrorFrmServerMsg(data.Status);
                                toastr.warning($("#MessageText").html());
                            }

                        },
                        error: function () {
                            ErrorFrmClientMsg();
                            toastr.warning($("#MessageText").html());
                        },
                        // complete: function () { CompletedMsg(); },
                    }); //End of ajax call
                }
            }
            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }
        }
        $('#btnView').click(function () {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');

            var model = {};

            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.DayNumber = $("#DayNumber").val();

            model.OperationMode = $("#OperationMode").val();
            model.Designation = $("#Designation").val();
            model.LocCode = $("#LocCode").val();
            var Input = InputValidation('MonthNumber') + InputValidation('Year') + InputValidation('Designation') + InputValidation('OperationMode') + InputValidation('LocCode');
            if (Input == 0) {

                if ((model.Designation == "TM" || model.Designation == "RSM") && (model.OperationMode == "DVR" || model.OperationMode == "PWDS" || model.OperationMode == "GWDS")) {

                    ValidationMsg();
                    toastr.warning($("#MessageText").html());
                }
                else {
                    GetBulkDataMaking(model);
                }
            }
            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }
        });

        function GetBulkDataMaking(model) {
            $("#table-container").html('');
            $("#btnWaiting").attr("disabled", true);
            $("#btnApprove").attr("disabled", true);
            $.ajax({
                url: '/DeleteTpDvrPwdsGwdsBillMpoTmRsm/GetViewDataAsInput',
                data: JSON.stringify({ model }),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {
                    if (data.dt1.length > 0) {
                        $("#btnWaiting").attr("disabled", false);
                        $("#btnApprove").attr("disabled", false);
                        $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
                        GetViewTable(data.dt1);
                    }
                    else {
                        AcknowledgeMsg();
                        toastr.warning($("#MessageText").html());
                    }

                },
                error: function () {
                    alert('Error occured!');
                },
            });
        }
        //--------------------------------------


        //this function will be called when button is clicked
        function GetViewTable(jsonDataList) {

            debugger;
            //Get the headers from JSON data
            var headers = Object.keys(jsonDataList[0]);

            //Prepare html header
            var headerRowHTML = '<tr>';
            $.each(headers, function (i, header) {
                headerRowHTML += '<th>' + header + '</th>';
            });
            headerRowHTML += '</tr>';

            //Creating table with headers
            var tableHTML = '<table class="table table-bordered table-striped">' + headerRowHTML + '</table>';
            $("#table-container").html(tableHTML);

            //Prepare all the employee records as HTML
            var allRecordsHTML = '';
            $.each(jsonDataList, function (i, row) {

                //Prepare html row
                allRecordsHTML += '<tr>';
                $.each(headers, function (j, header) {
                    allRecordsHTML += '<td>' + row[header] + '</td>';
                });
                allRecordsHTML += '</tr>';

            });

            //Appending the all records to table
            $("table").append(allRecordsHTML);
        }
        //--------------------------------------

    });


</script>



<div class="box-header with-border">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2"><div id="MessageText"></div></div>
        <div class="col-xs-0 col-sm-0 col-md-10 col-lg-10">
            <div style="text-align:right;">
                <input type="checkbox" id="IsActive" class="chk" name="IsActive"> <label for="IsActive"> Hide</label>
                <button id="btnApprove" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon glyphicon-ok"></i> Approve</button>
                <button id="btnWaiting" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-retweet"></i> Waiting</button>
                <button id="btnDelete" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-remove"></i> Delete</button>
                <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-search"></i> View</button>
            </div>
        </div>


    </div>
</div>
<div class="box-body">
    <div class="row" id="divValueParameter">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Operation:</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <select id="OperationMode" name="OperationMode" class="RequiredField form-control">
                    <option value=""></option>
                    <option value="TP">TP Mpo</option>
                    <option value="DVR">DVR</option>
                    <option value="PWDS">PWDS</option>
                    <option value="GWDS">GWDS</option>
                    <option value="BILL">Bill Mpo</option>
                    <option value="TmRsmBILL">Bill Tm/Rsm/Dsm</option>
                    <option value="TmRsmTP">TP Tm/Rsm/Dsm</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Year-Month-Day:</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <div class="input-group">

                    <input type="text" id="Year" name="Year" class="datepicker RequiredField form-control" />
                    <span class="input-group-btn" style="width:0px;"></span>
                    <select id="MonthNumber" name="MonthNumber" class=" RequiredField form-control"></select>
                    <span class="input-group-btn" style="width:0px;"></span>
                    <select id="DayNumber" name="DayNumber" class="RequiredField form-control">
                        <option value=""></option>
                        <option value="01">01</option>
                        <option value="02">02</option>
                        <option value="03">03</option>
                        <option value="04">04</option>
                        <option value="05">05</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                        <option value="08">08</option>
                        <option value="09">09</option>
                        <option value="10">10</option>

                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>

                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>

                    </select>
                </div>
            </div>

            <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3">
            </div>
        </div>


        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Designation:</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <select id="Designation" name="Designation" class="RequiredField form-control">
                    <option value=""></option>
                    <option value="DSM">DSM</option>
                    <option value="RSM">RSM</option>
                    <option value="TM">TM</option>
                    <option value="MPO">MPO</option>
                </select>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-2 col-lg-2">Employee:</div>
            <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                <select id="LocCode" name="LocCode" class="RequiredField form-control"></select>
                <input type="hidden" id="LocName" name="LocName" class="RequiredField form-control">
            </div>
            <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3"></div>
        </div>
    </div>
        <br />
        <br />
        <div class="row">
            <div id="table-container"></div>
        </div>






        <div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
            <p style="position: absolute; top: 50%; left: 50%; color: White;">
                <img src="~/Content/Images/loading.gif" />
            </p>
        </div>
    </div>



