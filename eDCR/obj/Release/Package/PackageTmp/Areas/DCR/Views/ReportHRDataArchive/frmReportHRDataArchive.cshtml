@{
    //ViewBag.Title = "frmImportExcelToGrid";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="box-header with-border">
    @*Form Title*@
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4"> <div id="MessageText"></div></div>
        <div class="col-xs-0 col-sm-0 col-md-8 col-lg-8">
            <div style="text-align:right;">
                <button id="btnExcel" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-envelope"></i> Excel </button>
                <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-file"></i> View</button>
            </div>
        </div>
    </div>
</div>
<div class="box-body">
    <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3"> Month - Year :</div>
        <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
            <div class="input-group">
                <select id="MonthNumber" name="MonthNumber" class=" RequiredField form-control"></select>
                <span class="input-group-btn" style="width:0px;"></span>
                <input type="text" id="Year" name="Year" class="datepicker RequiredField form-control" />
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div id="MainGrid" class="MainGrid">
                <div class="k-loading-mask" style="width:100%;height:100%">
                    <span class="k-loading-text">Loading...</span>
                    <div class="k-loading-image">
                        <div class="k-loading-color">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />

<script src="~/Scripts/xlsx_0.7.12_xlsx.full.min.js"></script>

<script type="text/javascript">
    //// Start  $(document).ready(function ()
    $(document).ready(function () {

        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });



        $(".k-loading-mask").hide();


        LoadMonth();

        $(".datepicker").datepicker({
            format: " yyyy",
            viewMode: "years",
            minViewMode: "years",
            autoclose: true
        });
        $("#Year").val(yyyy);


        function LoadMonth() {
            $.ajax({
                url: '/Default/GetGenMonth',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#MonthNumber').append($('<option>', { value: item.MonthNumber, html: item.MonthName }, '<option/>'));
                    });
                },
                error: function () {
                    alert("Failed to load !!");
                }
            });
        }


        EventPermission();
        $('#btnReset').click(function () {

            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);


            $("#files").val('');
            $(".txtBox").css("border-color", "");
            $(".k-upload-files").remove();
            $(".k-upload-status").remove();
            $(".k-upload.k-header").addClass("k-upload-empty");
            $(".k-upload-button").removeClass("k-state-focused");
            ResetData();


        });

        $('#btnExcel').click(function () {
            $("#MainGrid").getKendoGrid().saveAsExcel();
        });

        //***************view function*****************
        $('#btnView').click(function () {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);


            $(".k-loading-mask").show();

            var model = {};
            model.Year = $('#Year').val();
            model.MonthNumber = $('#MonthNumber').val();
            var Input = InputValidation('MonthNumber') + InputValidation('Year') ;
            if (Input == 0) {

                $.ajax({
                    type: "POST",
                    url: "/ReportHRDataArchive/GetGridData",
                    data: JSON.stringify({ model: model }),
                    dataType: 'json',
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data.length > 0) {

                            $("#MainGrid").data("kendoGrid").dataSource.data(data);
                            $(".k-loading-mask").hide();
                        }
                        else {
                            $(".k-loading-mask").hide();
                            AcknowledgeMsg();
                            toastr.warning("No Record Found!");
                        }
                    },

                });
            }
            else {
                $(".k-loading-mask").hide();
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }

        });




     //Initializing Main page details Kendo Grid Colums
        var MainGrid = $('#MainGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "EmployeeID",
                        fields: {
                            EmployeeID: { type: "string" },
                            EmployeeName: { type: "string" },
                            Designation: { type: "string" },
                            Phone: { type: "string" },
                            ProductGroup: { type: "string" },
                            MarketGroup: { type: "string" },
                            MarketCode: { type: "string" },
                            MarketName: { type: "string" },
                            TerritoryCode: { type: "string" },
                            TerritoryName: { type: "string" },
                            RegionCode: { type: "string" },
                            RegionName: { type: "string" },
                            DepotCode: { type: "string" },
                            DepotName: { type: "string" },
                            DivisionCode: { type: "string" },
                            DivisionName: { type: "string" }

                        }
                    }
                },
               // pageSize: 10,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },
            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);

            },
            scrollable: true,
            sortable: true,
            filterable: false,
            editable: false,
            selectable: "row",
            //selectable: "multiple",
            toolbar: [{ template: "<input type='text' id='txtTerritoryName'  style='float:right' placeholder='TerritoryName...' class='k-textbox'>" }, { template: "<input type='text' id='txtMarketName'  style='float:right' placeholder='MarketName...' class='k-textbox'>" }, { template: "<input type='text' id='txtMarketCode'  style='float:right' placeholder='MarketCode...' class='k-textbox'>" }, { template: "<input type='text' id='txtMpoName'  style='float:right' placeholder='MpoName...' class='k-textbox'>" }, { template: "<input type='text' id='txtMpoCode'  style='float:right' placeholder='MpoCode...' class='k-textbox'>" }, ],
           // toolbar: [{ name: "excel", text: "Format" }, { template: "<input type='text' id='txtMPO'  style='float:right' placeholder='Search...' class='k-textbox'>" },],            //excel: {
            //    fileName: "UploadFileFormat.xlsx",
            //    allPages: true,
            //    filterable: true
            //},
            excel: {
                fileName: "HR.xlsx",
                allPages: true,
                filterable: true
            },
            navigatable: true,
            height: 400,
            //groupable: true,
            //groupable: { messages: { empty: "Tour Plan" } },
            columnMenu: false,
            reorderable: false,
            resizable: false,
            resize: function (e) {
                this.table.height(this.element.height() + this.table.height() - 1);
            },
            columns: [

                 { field: "EmployeeID", hidden: false, title: "EmployeeID" },
                 { field: "EmployeeName", hidden: false, title: "EmployeeName" },
                 { field: "Designation", hidden: false, title: "Designation" },
                 { field: "Phone", hidden: false, title: "Phone" },
                 { field: "ProductGroup", hidden: false, title: "ProductGroup" },
                 { field: "MarketGroup", hidden: false, title: "MarketGroup" },
                 { field: "MarketCode", hidden: false, title: "MarketCode" },
                 { field: "MarketName", hidden: false, title: "MarketName" },
                 { field: "TerritoryCode", hidden: false, title: "TerritoryCode" },
                 { field: "TerritoryName", hidden: false, title: "TerritoryName" },
                 { field: "RegionCode", hidden: false, title: "RegionCode" },
                 { field: "RegionName", hidden: false, title: "RegionName" },
                 { field: "DepotCode", hidden: false, title: "DepotCode" },
                 { field: "DepotName", hidden: false, title: "DepotName" },
                 { field: "DivisionCode", hidden: false, title: "DivisionCode" },
                 { field: "DivisionName", hidden: false, title: "DivisionName" },



            ]
        }).data('kendoGrid');




        // Filter table row

        $("#txtMpoCode").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "EmployeeID", operator: "contains", value: val },
        
                ]
            });
        });
        $("#txtMpoName").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [          
                    { field: "EmployeeName", operator: "contains", value: val },
               
                ]
            });
        });

        $("#txtMarketCode").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
             
                    { field: "MarketCode", operator: "contains", value: val }
                ]
            });
        });

        $("#txtMarketName").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [                
                    { field: "MarketName", operator: "contains", value: val }
                ]
            });
        });
        $("#txtTerritoryName").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [            
                    { field: "TerritoryName", operator: "contains", value: val }
                ]
            });
        });
      

    

     



    });








</script>




