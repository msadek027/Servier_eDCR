@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CustomCSS/InputText.css" rel="stylesheet" />
<link href="~/Content/CustomCSS/exportPDF.css" rel="stylesheet" />
<script src="~/Scripts/CustomJS/DefaultValue.js"></script>


<script>

    $(document).ready(function () {
        $.ajaxSetup({
            beforeSend: function () {
                $("#divLoading").show();
            },
            complete: function () {
                $("#divLoading").hide();
            }
        });


        EventPermission();
        LoadMonth();

        $(".datepicker").datepicker({
            format: " yyyy",
            viewMode: "years",
            minViewMode: "years",
            autoclose: true
        });
        $("#Year").val(yyyy);


        function LoadMonth() {
            $.ajax({
                url: '/Default/GetGenMonth',
                type: 'GET',
                dataType: 'JSON',
                data: "{}",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $('#MonthNumber').append($('<option>', { value: item.MonthNumber, html: item.MonthName }, '<option/>'));
                    });
                },
                error: function () {
                    alert("Failed to load !!");
                }
            });
        }


        LoadRegion();
        function LoadRegion() {
            $.ajax({
                url: '/Default/GetRegion',
                type: 'get',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    $.each(data, function (i, item) {

                        if (i == 0) {
                            if (data.length > 1) {
                                $('#RegionCode').append('<option value="" selected="selected"></option>');
                            }

                            $('#RegionName').val(item.RegionName);
                        }
                        $('#RegionCode').append($('<option>', { value: item.RegionCode, html: item.RegionName }, '<option/>'));

                    });
                },
                error: function () {
                    alert("Failed to load...");
                }
            });
        }
        $('#RegionCode').on('change', function () {
            $('#RegionName').val($("#RegionCode option:selected").text());
        }).trigger('change');;
         $('#Designation').on('change', function () {
            GetEmpForSup($("#RegionCode").val(), $(this).val());
        }).trigger('change');

          $('#LocCode').select2();
        function GetEmpForSup(RegionCode, Designation) {


            //var buyer = $('#BuyerID').val();
            RegionCode = JSON.stringify(RegionCode);

            if (Designation != "") {

                $.ajax({
                    type: "POST",
                    url: '/Default/GetEmpForOwnSupfrmRegionDesignationFnIn',
                    data: JSON.stringify({ RegionCode: RegionCode, Designation: Designation }),
                    dataType: 'json',
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        $('#LocCode').empty();
                        $.each(data, function (i, item) {

                            if (i == 0) {
                                if (data.length > 1) {
                                    $('#LocCode').append('<option value="" selected="selected"></option>');
                                }
                            }

                            $('#LocCode').append($('<option>', { value: item.LocCode, html: item.EmployeeName }, '<option/>'));
                            $('#LocName').val(item.EmployeeName);

                        });

                    },
                    error: function () {
                        alert("Failed to load... !!");
                    }
                });
            }
            else {
                $('#LocCode').append('<option value="" selected="selected"></option>');
            }
        }


        $('#LocCode').on('change', function () {
            $('#LocName').val($("#LocCode option:selected").text());
        }).trigger('change');



        $('#IsActive').click(function () {
            if ($(this).is(':checked')) {
                $(this).siblings('label').html('Unhide');
                $('#divValueParameter').hide();
            }
            else {
                $(this).siblings('label').html('Hide');
                $('#divValueParameter').show();
            }
        });


        $('#btnView').click(function () {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
            $('#MainGrid').data('kendoGrid').dataSource.filter([]);
            $('#MainGrid').data('kendoGrid').dataSource.data([]);

            var model = {};


            model.Year = $("#Year").val();
            model.MonthNumber = $("#MonthNumber").val();
            model.Designation = $("#Designation").val();
            model.LocCode = $("#LocCode").val();
            model.RegionCode = $("#RegionCode").val();
            model.Operation = $("#Operation").val();
            model.WhoWhom = $("#WhoWhom").val();
            var Input = InputValidation('MonthNumber') + InputValidation('Year') + InputValidation('RegionCode') + InputValidation('Designation') + InputValidation('WhoWhom') ;
            if (Input == 0) {
                  $("#divLoading").show();
                    $.ajax({
                        type: "POST",
                        url: "/ReportActivityLog/GetActivityLog",
                        data: JSON.stringify({ model: model }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            if (data.length > 0) {

                                $("#MainGrid").data("kendoGrid").dataSource.data(data);
                            }
                            $("#divLoading").hide();
                        },

                    });
            }
            else {
                ValidationMsg();
                toastr.warning($("#MessageText").html());
            }
            $("#Year").val(model.Year);
        });



        var MainGrid = $('#MainGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: false,
                schema: {
                    model: {
                        id: "SL",
                        fields: {                        
                            SL: { type: "string" },                       
                            MarketName: { type: "string" },
                            EmployeeCode: { type: "string" },
                            EmployeeName: { type: "string" },
                            Designation: { type: "string" },
                            SetDate: { type: "string" },
                            Operation: { type: "string" },

                            Message: { type: "string" },
                            Terminal: { type: "string" },
                            SetByID: { type: "string" },
                            SetByName: { type: "string" },
                        }
                    }
                },
                pageSize: 100,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 10
            },

            dataBound: function (e) {
                AutoFitColumn(this.element[0].id);
            },

            edit: function (e) {              
                $('input[name = "Designation"]').attr("readonly", true);
                $('input[name = "EmployeeCode"]').attr("readonly", true);
        
            },
           
            selectable: "row",
            //selectable: "multiple",
            toolbar: [{ template: "<input type='text' id='txtOperation'  style='float:right' placeholder='Operation...' class='k-textbox'>" }, { template: "<input type='text' id='txtEmployeeCode'  style='float:right' placeholder='EmployeeCode...' class='k-textbox'>" } ],

            height: 450,
            scrollable: true,
            sortable: true,
            filterable: false,
            editable: false,
            navigatable: false,
            columnMenu: false,
            reorderable: false,
            //resizable: true,
            //resize: function (e) {
            //    this.table.height(this.element.height() + this.table.height() - 1);
            //},
            columns: [
                { field: "SL", title: "SL", width: 15 },
                { field: "MarketName", title: "Market Name", width: 40 },
                { field: "EmployeeCode", title: "Employee Code",  width: 30 },
                { field: "EmployeeName", title: "Employee Name", width: 30 },
                { field: "Designation", title: "Designation", width: 30 },        
                { field: "SetDate", title: "Date Time", width: 40 },
                { field: "Operation", title: "Operation", width: 40 },
                { field: "Message", title: "Message", width: 40 },
                { field: "Terminal", title: "Terminal", width: 40 },
                { field: "SetByID", title: "Set By ID", width: 40 },
                { field: "SetByName", title: "Set By Name", width: 40 },

           ],
        }).data('kendoGrid');

        $("#txtOperation").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "Operation", operator: "contains", value: val },
                 
                ]
            });
        });

      

        $("#txtEmployeeCode").keyup(function () {
            var val = $(this).val();
            $("#MainGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    { field: "EmployeeCode", operator: "contains", value: val },

                ]
            });
        });







    });


</script>



<div class="box-header with-border">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <form class="form" action="/ReportActivityLog/GetExportActivityLog" id="R1Form" method="post" name="H1Form" target="_blank">
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2"><div id="MessageText"></div></div>
                    <div class="col-xs-0 col-sm-0 col-md-10 col-lg-10">
                        <div style="text-align:right;">
                            <input type="checkbox" id="IsActive" class="chk" name="IsActive"> <label for="IsActive"> Hide</label>
                            <button id="btnExcel" class="btn btn-primary btn-sm" name="ExportType" value="Excel" type="submit"><i class="glyphicon glyphicon-envelope"></i> Excel </button>
                            <button id="btnPDF" class="btn btn-primary btn-sm" name="ExportType" value="PDF" type="submit"><i class="glyphicon glyphicon-book"></i> PDF </button>
                            <button id="btnView" class="btn btn-primary btn-sm" type="button"><i class="glyphicon glyphicon-file"></i> View</button>
                        </div>
                    </div>
                        </div>

                        <div class="box-body">

                            <div class="row" id="divValueParameter">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3"> Month - Year :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
                                        <div class="input-group">
                                            <select id="MonthNumber" name="MonthNumber" class="RequiredField form-control"></select>
                                            <span class="input-group-btn" style="width:0px;"></span>
                                            <input type="text" id="Year" name="Year" class="datepicker RequiredField form-control" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">Region Name :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
                                        <select id="RegionCode" name="RegionCode" class="RequiredField form-control"></select>
                                        <input type="hidden" id="RegionName" name="RegionName" class="RequiredField form-control">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">Designation  :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
                                        <select id="Designation" name="Designation" class="RequiredField form-control">
                                            <option value=""></option>
                                            <option value="DSM">DSM</option>
                                            <option value="RSM">RSM</option>
                                            <option value="TM">TM</option>
                                            <option value="MPO">MPO</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">Employee Name :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-4 col-lg-4">
                                        <select id="LocCode" name="LocCode" class="RequiredField form-control"></select>
                                        <input type="hidden" id="LocName" name="LocName" class="RequiredField form-control">
                                    </div>
                                    <div class="col-xs-0 col-sm-0 col-md-2 col-lg-2">

                                        <select id="WhoWhom" name="WhoWhom" class="RequiredField form-control">
                                            <option value="Act-by-him">Act-by-him</option>
                                            <option value="Act-for-him">Act-for-him</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-0 col-sm-0 col-md-3 col-lg-3"> </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">Operation  :</div>
                                    <div class="col-xs-0 col-sm-0 col-md-6 col-lg-6">
                                        <select id="Operation" name="Operation" class="RequiredField form-control">
                                            <option value=""></option>
                                            <option value="TP">TP</option>
                                            <option value="DVR">DVR</option>
                                            <option value="PWDS">PWDS</option>
                                            <option value="GWDS">GWDS</option>
                                            <option value="Sample">Sample</option>
                                        </select>
                                    </div>
                                </div>



                            </div>
                        </div>
            </form>
        </div>
    </div>
</div>
<div class="row">
    <div id="MainGrid" class="MainGrid"></div>
</div>



<div class="row">
    <div id="TerritoryPopupWindow" class="PopupWindowLayout" style="display: none;">
        <div id="TerritoryPopupWindowGrid" class="PopUpGrid"></div>
    </div>
</div>

<div class="row">
    <div id="PopupWindow" class="PopupWindowLayout" style="display: none;">
        <div id="PopupWindowGrid" class="PopUpGrid"></div>
    </div>
</div>



<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
    <p style="position: absolute; top: 50%; left: 50%; color: White;">
        <img src="~/Content/Images/loading.gif" />
    </p>
</div>





